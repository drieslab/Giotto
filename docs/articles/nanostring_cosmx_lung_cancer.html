<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Giotto">
<title>Nanostring CosMx Subcellular Lung Cancer â€¢ Giotto</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/JetBrains_Mono-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nanostring CosMx Subcellular Lung Cancer">
<meta property="og:description" content="Giotto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Giotto</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-get-started">Get started</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-get-started">
    <a class="dropdown-item" href="../articles/installation.html">Giotto Installation</a>
    <a class="dropdown-item" href="../articles/ecosystem.html">Giotto Ecosystem</a>
    <a class="dropdown-item" href="../articles/configuration.html">Giotto Configuration</a>
    <a class="dropdown-item" href="../articles/object_creation.html">Giotto Object Creation</a>
    <a class="dropdown-item" href="../articles/structure.html">Giotto Class Structure</a>
    <a class="dropdown-item" href="../articles/structure.html">Giotto Class Structure</a>
    <a class="dropdown-item" href="../articles/errorsfaqsandtips.html">Solutions to Installation Errors</a>
    <a class="dropdown-item" href="../articles/faqs.html">FAQs</a>
    <a class="dropdown-item" href="../articles/branches.html">Branches</a>
    <a class="dropdown-item" href="../articles/github_issues.html">How to report a bug</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Documentation</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-seq-scope">Seq-Scope</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-seq-scope">
        <a class="dropdown-item" href="../articles/seqscope_mouse_liver.html">Mouse liver</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-visium">Visium</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-visium">
        <a class="dropdown-item" href="../articles/visium_mouse_kidney.html">Visium Mouse Kidney</a>
        <a class="dropdown-item" href="../articles/visium_mouse_brain.html">Visium Mouse Brain</a>
        <a class="dropdown-item" href="../articles/visium_prostate_integration.html">Visium Prostate Integration</a>
        <a class="dropdown-item" href="../articles/visium_cytassist_lungcancer.html">CytAssist Human Lung Cancer</a>
        <a class="dropdown-item" href="../articles/visium_cytassist_human_glioblastoma.html">CytAssist Multi-omics Human Glioblastoma</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-spatial-genomics">Spatial Genomics</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-spatial-genomics">
        <a class="dropdown-item" href="../articles/spatial_genomics_mouse_kidney.html">Mouse Kidney</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-xenium">Xenium</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-xenium">
        <a class="dropdown-item" href="../articles/xenium_breast_cancer.html">Xenium Human breast cancer</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-nanostring-cosmx">Nanostring CosMx</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-nanostring-cosmx">
        <a class="dropdown-item" href="../articles/nanostring_cosmx_lung_cancer.html">Nanostring CosMx Subcellular Lung Cancer</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-merfish">MERFISH</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-merfish">
        <a class="dropdown-item" href="../articles/merfish_mouse_hypothalamic.html">MERFISH Mouse Hypothalamic Preoptic Region</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vizgen">Vizgen</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-vizgen">
        <a class="dropdown-item" href="../articles/vizgen_mouse_brain.html">Vizgen Mouse Brain Receptor Map</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-seqfish">seqFISH</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-seqfish">
        <a class="dropdown-item" href="../articles/mini_seqfish.html">mini seqFISH</a>
        <a class="dropdown-item" href="../articles/seqfish_cortex.html">SeqFish+ Mouse Cortex Example</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-osmfish">osmFISH</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-osmfish">
        <a class="dropdown-item" href="../articles/osmfish_mouse_ss_cortex.html">osmFISH Mouse SS Cortex</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-resolve-bioscience">Resolve Bioscience</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-resolve-bioscience">
        <a class="dropdown-item" href="../articles/resolve_biosciences.html">Resolve Bioscience Breast Cancer Subcellular</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-codex">CODEX</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-codex">
        <a class="dropdown-item" href="../articles/codex_mouse_spleen.html">Codex Mouse Spleen</a>
      </div>
    </li>
    <div class="dropdown-divider"></div>
    <li class="dropdown-item">
      <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-single-cell-rna-sequencing">Single Cell RNA Sequencing</a>
      <div class="dropdown-menu" aria-labelledby="dropdown-single-cell-rna-sequencing">
        <a class="dropdown-item" href="../articles/singlecell_prostate_standard.html">Prostate</a>
        <a class="dropdown-item" href="../articles/singlecell_prostate_integration.html">Prostate Integration</a>
      </div>
    </li>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <h6 class="dropdown-header" data-toc-skip>Spatial manipulation</h6>
    <a class="dropdown-item" href="../articles/spatial_transformations.html">Spatial transformations</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Image alignment</h6>
    <a class="dropdown-item" href="../articles/image_alignment.html">Image alignment</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Interactive selection</h6>
    <a class="dropdown-item" href="../articles/interactive_selection.html">Interactive selection</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Visualizations</h6>
    <a class="dropdown-item" href="../articles/visualizations.html">Visualizations</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Saving and Loading</h6>
    <a class="dropdown-item" href="../articles/saving_object.html">Saving a Giotto object</a>
    <a class="dropdown-item" href="../articles/saving_plots.html">Saving plots</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Interoperability</h6>
    <a class="dropdown-item" href="../articles/interoperability_anndata.html">AnnData</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Try Giotto in the Cloud</h6>
    <a class="dropdown-item" href="../articles/terra.html">Terra.bio</a>
    <a class="dropdown-item" href="../articles/docker.html">Docker</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <a class="dropdown-item" href="../news/index.html">Changes</a>
    <a class="dropdown-item" href="../articles/presentations.html">Presentations</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/drieslab/Giotto/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Nanostring CosMx Subcellular Lung Cancer</h1>
            
            <h4 data-toc-skip class="date">2022-11-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drieslab/Giotto/blob/HEAD/vignettes/nanostring_cosmx_lung_cancer.Rmd" class="external-link"><code>vignettes/nanostring_cosmx_lung_cancer.Rmd</code></a></small>
      <div class="d-none name"><code>nanostring_cosmx_lung_cancer.Rmd</code></div>
    </div>

    
    
<p>This example uses subcellular data from Nanostringâ€™s CosMx Spatial
Molecular Imager. This publicly available <a href="https://www.nanostring.com/products/cosmx-spatial-molecular-imager/ffpe-dataset/" class="external-link">dataset</a>
is from an FFPE sample of non-small-cell lung cancer (NSCLC). This
example works with Lung12.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ensure Giotto Suite is installed.</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="st">"Giotto"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"drieslab/Giotto@suite"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://drieslab.github.io/Giotto/">Giotto</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure the Python environment for Giotto has been installed.</span></span>
<span><span class="va">genv_exists</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/checkGiottoEnvironment.html">checkGiottoEnvironment</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">genv_exists</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># The following command need only be run once to install the Giotto environment.</span></span>
<span>  <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/installGiottoEnvironment.html">installGiottoEnvironment</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="setup">1. Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom color palettes from rcartocolor</span></span>
<span><span class="co"># pal10 = rcartocolor::carto_pal(n = 10, name = 'Pastel')</span></span>
<span><span class="va">pal10</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#66C5CC"</span>,<span class="st">"#F6CF71"</span>,<span class="st">"#F89C74"</span>,<span class="st">"#DCB0F2"</span>,<span class="st">"#87C55F"</span>,</span>
<span>          <span class="st">"#9EB9F3"</span>,<span class="st">"#FE88B1"</span>,<span class="st">"#C9DB74"</span>,<span class="st">"#8BE0A4"</span>,<span class="st">"#B3B3B3"</span><span class="op">)</span></span>
<span><span class="co"># viv10 = rcartocolor::carto_pal(n = 10, name = 'Vivid')</span></span>
<span><span class="va">viv10</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E58606"</span>,<span class="st">"#5D69B1"</span>,<span class="st">"#52BCA3"</span>,<span class="st">"#99C945"</span>,<span class="st">"#CC61B0"</span>,</span>
<span>          <span class="st">"#24796C"</span>,<span class="st">"#DAA51B"</span>,<span class="st">"#2F8AC4"</span>,<span class="st">"#764E9F"</span>,<span class="st">"#A5AA99"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set working directory</span></span>
<span><span class="va">results_folder</span> <span class="op">=</span> <span class="st">'/path/to/directory'</span></span>
<span></span>
<span><span class="co"># Optional: Specify a path to a Python executable within a conda or miniconda</span></span>
<span><span class="co"># environment. If set to NULL (default), the Python executable within the previously</span></span>
<span><span class="co"># installed Giotto environment will be used.</span></span>
<span><span class="va">my_python_path</span> <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># alternatively, "/local/python/path/python" if desired.</span></span>
<span></span>
<span><span class="co">## Set object behavior</span></span>
<span><span class="co"># by directly saving plots, but not rendering them you will save a lot of time</span></span>
<span><span class="va">instrs</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/createGiottoInstructions.html">createGiottoInstructions</a></span><span class="op">(</span>save_dir <span class="op">=</span> <span class="va">results_folder</span>,</span>
<span>                                  save_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  show_plot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  return_plot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  python_path <span class="op">=</span> <span class="va">my_python_path</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="sec-loadfxn">1.1 CosMx Project loading function<a class="anchor" aria-label="anchor" href="#sec-loadfxn"></a>
</h3>
<p>Convenience function for loading in the CosMx data. It loads
subcellular transcript information and polygons and generates a
<code>giotto</code> object with <code>giottoPoints</code> objects for
both â€˜rnaâ€™ and â€˜neg_probeâ€™ nested in the gobject <code>feat_info</code>
slot, and a <code>giottoPolygon</code> object for the â€˜cellâ€™ spatial
unit in the <code>spatial_info</code> slot.</p>
<p>This function performs the manual object creation steps described
below. To skip those steps and preliminary data exploration, go to
Section 5.</p>
<p>Additionally, a comparison of the count matrix produced through the
convenience function â€˜subcellularâ€™ workflow and Nanostringâ€™s provided
matrix can be found at Section 6.4.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## provide path to nanostring folder</span></span>
<span><span class="va">data_path</span> <span class="op">=</span> <span class="st">'/path/to/data/Lung12-Flat_files_and_images/'</span></span>
<span></span>
<span><span class="co">## create giotto cosmx object</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="../reference/createGiottoCosMxObject.html">createGiottoCosMxObject</a></span><span class="op">(</span>cosmx_dir <span class="op">=</span> <span class="va">data_path</span>,</span>
<span>                                   data_to_use <span class="op">=</span> <span class="st">'subcellular'</span>, <span class="co"># only subcellular</span></span>
<span>                                   FOVs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>                                   instructions <span class="op">=</span> <span class="va">instrs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/showGiottoFeatInfo.html">showGiottoFeatInfo</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/showGiottoSpatialInfo.html">showGiottoSpatialInfo</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-exploration-and-loading">2. Data exploration and loading<a class="anchor" aria-label="anchor" href="#data-exploration-and-loading"></a>
</h2>
<div class="section level3">
<h3 id="subcellular-detections-points-info">2.1 Subcellular detections (points info)<a class="anchor" aria-label="anchor" href="#subcellular-detections-points-info"></a>
</h3>
<p><code>tx_file.csv</code> contains the subcellular detections
information. It contains information on each of the individual feature
detections within the sample.</p>
<ul>
<li>
<strong>fov</strong> which FOV the detection happened in</li>
<li>
<strong>cell_ID</strong> the ID of the cell the detection happened
in</li>
<li>
<strong>x_global_px</strong> the global spatial x location in
pixels</li>
<li>
<strong>y_global_px</strong> the global spatial y location in
pixels</li>
<li>
<strong>x_local_px</strong> the spatial x location in pixels within
the FOV</li>
<li>
<strong>y_local_px</strong> the spatial y location in pixels within
the FOV</li>
<li>
<strong>z</strong> the z plane the detection was called in (-1 to
16)</li>
<li>
<strong>target</strong> the feature the probe is targeted
against</li>
<li>
<strong>CellComp</strong> Cellular compartment the detection
happened in (0, Cytoplasm, Membrane, Nuclear)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## provide path to nanostring folder</span></span>
<span><span class="va">data_path</span> <span class="op">=</span> <span class="st">'/path/to/data/Lung12-Flat_files_and_images/'</span></span>
<span></span>
<span><span class="co"># load transcript coordinates</span></span>
<span><span class="va">tx_coord_all</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">'Lung12_tx_file.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/row-plus-colnames-generic.html">colnames</a></span><span class="op">(</span><span class="va">tx_coord_all</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'\n'</span><span class="op">)</span></span>
<span><span class="co"># z planes</span></span>
<span><span class="va">tx_coord_all</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'\n'</span><span class="op">)</span></span>
<span><span class="co"># Cell compartment</span></span>
<span><span class="va">tx_coord_all</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">CellComp</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># [1] "fov"         "cell_ID"     "x_global_px" "y_global_px"</span></span>
<span><span class="co"># [5] "x_local_px"  "y_local_px"  "z"           "target"     </span></span>
<span><span class="co"># [9] "CellComp" </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># z</span></span>
<span><span class="co">#      -1       0       1       2       3       4       5       6 </span></span>
<span><span class="co">#   23723 3466178 2522315 2694973 2686531 2648926 2660346 2711105 </span></span>
<span><span class="co">#       7       8       9      10      11      12      13      14 </span></span>
<span><span class="co"># 2855259 3700831   36840    6594    6466    6787    6944    6959 </span></span>
<span><span class="co">#      15      16 </span></span>
<span><span class="co">#   17603       2 </span></span>
<span><span class="co">#   </span></span>
<span><span class="co"># CellComp</span></span>
<span><span class="co">#         0 Cytoplasm  Membrane   Nuclear </span></span>
<span><span class="co">#   6619744   5770549   3368411  10299678</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="split-detections-by-features-vs-negative-probes">2.2 Split detections by features vs negative probes<a class="anchor" aria-label="anchor" href="#split-detections-by-features-vs-negative-probes"></a>
</h3>
<p><code>tx_file.csv</code> contains information on both actual features
(960 targeted gene probes in this dataset) and negative probes (20) that
are targeted to alien sequences defined by the External RNA Controls
Consortium (ERCC) that do not exist in human tissue. These two types of
detections will be treated as separate feature types
(<code>feat_type</code>) and placed in separate expression matrices.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_IDs</span> <span class="op">=</span> <span class="va">tx_coord_all</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># negative probe IDs</span></span>
<span><span class="va">neg_IDs</span> <span class="op">=</span> <span class="va">all_IDs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">'NegPrb'</span>, <span class="va">all_IDs</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Negative Probe IDs\n'</span><span class="op">)</span></span>
<span><span class="va">neg_IDs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'\nFeature IDs\n'</span><span class="op">)</span></span>
<span><span class="va">feat_IDs</span> <span class="op">=</span> <span class="va">all_IDs</span><span class="op">[</span><span class="op">!</span><span class="va">all_IDs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">neg_IDs</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feat_IDs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># split detections</span></span>
<span><span class="va">feat_coords_all</span> <span class="op">=</span> <span class="va">tx_coord_all</span><span class="op">[</span><span class="va">target</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">feat_IDs</span><span class="op">]</span></span>
<span><span class="va">neg_coords_all</span> <span class="op">=</span> <span class="va">tx_coord_all</span><span class="op">[</span><span class="va">target</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">neg_IDs</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'\nFeatures: '</span>, <span class="va">feat_coords_all</span><span class="op">[</span>, <span class="va">.N</span><span class="op">]</span>, <span class="st">'\n'</span>,</span>
<span>    <span class="st">'NegProbes: '</span>, <span class="va">neg_coords_all</span><span class="op">[</span>, <span class="va">.N</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Negative Probe IDs</span></span>
<span><span class="co">#  [1] "NegPrb15" "NegPrb18" "NegPrb7"  "NegPrb21" "NegPrb13"</span></span>
<span><span class="co">#  [6] "NegPrb10" "NegPrb11" "NegPrb9"  "NegPrb3"  "NegPrb16"</span></span>
<span><span class="co"># [11] "NegPrb23" "NegPrb14" "NegPrb20" "NegPrb8"  "NegPrb19"</span></span>
<span><span class="co"># [16] "NegPrb6"  "NegPrb5"  "NegPrb12" "NegPrb17" "NegPrb22"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Number of feature IDs</span></span>
<span><span class="co"># [1] 960</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Features:  25875734</span></span>
<span><span class="co"># NegProbes:  182648</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#   [1] "IL7R"       "SEC61G"     "IGHA1"      "CD164"      "IL6"       </span></span>
<span><span class="co">#   [6] "CCR2"       "KRT86"      "NEAT1"      "NLRP1"      "S100A10"   </span></span>
<span><span class="co">#  [11] "KRT80"      "MYH11"      "OLR1"       "FYN"        "NR1H4"     </span></span>
<span><span class="co">#  [16] "NDRG1"      "AGR2"       "FGR"        "NFKB1"      "IL4R"      </span></span>
<span><span class="co">#  [21] "VWF"        "EOMES"      "COL16A1"    "IL1RL1"     "ITGAL"     </span></span>
<span><span class="co">#  [26] "GLUD1"      "STAT3"      "MAPK14"     "VHL"        "CD44"      </span></span>
<span><span class="co">#  [31] "RAMP1"      "ZFP36"      "CD27"       "GDF15"      "EPCAM"     </span></span>
<span><span class="co">#  [36] "LAMP3"      "LTB"        "COL12A1"    "LGALS9"     "HLA-DQB1"  </span></span>
<span><span class="co">#  [41] "CLU"        "ALCAM"      "TLR7"       "FGF1"       "NR1H3"     </span></span>
<span><span class="co">#  [46] "TNFSF18"    "EIF5A"      "LGALS3"     "CD63"       "FOXP3"     </span></span>
<span><span class="co">#  [51] "DCN"        "CUZD1"      "LIF"        "BMP6"       "HCST"      </span></span>
<span><span class="co">#  [56] "VSIR"       "STAT1"      "GDNF"       "UBE2C"      "APOA1"     </span></span>
<span><span class="co">#  [61] "ADGRF1"     "PDGFC"      "IL17A"      "YES1"       "TGFBR2"    </span></span>
<span><span class="co">#  [66] "GPX3"       "IFIH1"      "SOX9"       "MX1"        "IGKC"      </span></span>
<span><span class="co">#  [71] "CD8A"       "PTGES3"     "KRAS"       "CRYAB"      "ACTA2"     </span></span>
<span><span class="co">#  [76] "EGF"        "CD5L"       "BCL2L1"     "SRGN"       "FGFR3"     </span></span>
<span><span class="co">#  [81] "CD53"       "CELSR2"     "MTRNR2L1"   "LAMP2"      "LAIR1"     </span></span>
<span><span class="co">#  [86] "FGF13"      "EFNA1"      "CLEC2B"     "FZD5"       "SYK"       </span></span>
<span><span class="co">#  [91] "FES"        "MZT2A"      "SERPINA1"   "HIF1A"      "JUN"       </span></span>
<span><span class="co">#  [96] "THBS1"      "CHEK2"      "CD274"      "CXCL3"      "IL11"      </span></span>
<span><span class="co"># [101] "GPX1"       "FASLG"      "EPHA2"      "TGFB3"      "RARG"      </span></span>
<span><span class="co"># [106] "CLDN4"      "G6PC2"      "KITLG"      "ADGRG3"     "RPL34"     </span></span>
<span><span class="co"># [111] "HLA-A"      "ESAM"       "HDAC1"      "MGP"        "MECOM"     </span></span>
<span><span class="co"># [116] "MRC2"       "ACE2"       "COL4A2"     "CDH1"       "ATG10"     </span></span>
<span><span class="co"># [121] "IL32"       "SERPINA3"   "SRC"        "IGFBP6"     "IER3"      </span></span>
<span><span class="co"># [126] "QRFPR"      "CD276"      "ITGA9"      "INHBA"      "CXCL1"     </span></span>
<span><span class="co"># [131] "ATG12"      "ERBB2"      "FCRLA"      "TIE1"       "EFNB1"     </span></span>
<span><span class="co"># [136] "IGHG2"      "FZD3"       "SAA1"       "CCL23"      "JUNB"      </span></span>
<span><span class="co"># [141] "COTL1"      "CSF1R"      "TNFAIP6"    "KIT"        "RSPO1"     </span></span>
<span><span class="co"># [146] "RARB"       "CXCR4"      "CD28"       "FGFR2"      "RGS1"      </span></span>
<span><span class="co"># [151] "ACVR2A"     "CD3G"       "ADORA2A"    "IGFBP3"     "NOD2"      </span></span>
<span><span class="co"># [156] "KRT1"       "LPAR5"      "CD36"       "ACKR3"      "CCL3"      </span></span>
<span><span class="co"># [161] "CD48"       "TYK2"       "TGFB1"      "CD2"        "CTSG"      </span></span>
<span><span class="co"># [166] "CFLAR"      "IDO1"       "TIMP1"      "TGFBR1"     "BTK"       </span></span>
<span><span class="co"># [171] "BMP7"       "HSPB1"      "GDF10"      "CD37"       "ADIPOQ"    </span></span>
<span><span class="co"># [176] "WNT5A"      "TAP1"       "CRIP1"      "ATF3"       "PTHLH"     </span></span>
<span><span class="co"># [181] "ITGA3"      "CD3E"       "TGFB2"      "HLA-DRA"    "TLR8"      </span></span>
<span><span class="co"># [186] "ADGRG5"     "ITGAE"      "MKI67"      "EPHA4"      "CSF3"      </span></span>
<span><span class="co"># [191] "BMP3"       "COL6A1"     "IL1RN"      "CCR7"       "CD19"      </span></span>
<span><span class="co"># [196] "VCAN"       "FAS"        "WNT7A"      "FCGBP"      "IL18R1"    </span></span>
<span><span class="co"># [201] "EPHB4"      "TYROBP"     "KRT14"      "TACSTD2"    "PF4"       </span></span>
<span><span class="co"># [206] "JCHAIN"     "WIF1"       "ANXA2"      "CYSTM1"     "RPL32"     </span></span>
<span><span class="co"># [211] "KRT13"      "CFD"        "COL14A1"    "STMN1"      "CCL4"      </span></span>
<span><span class="co"># [216] "PTGS2"      "SUCNR1"     "RAD51"      "THBS2"      "KDR"       </span></span>
<span><span class="co"># [221] "SCGB3A1"    "CENPF"      "CD52"       "ROR1"       "GZMA"      </span></span>
<span><span class="co"># [226] "HCAR2"      "CSF3R"      "IL10RB"     "CXCL2"      "GZMH"      </span></span>
<span><span class="co"># [231] "PECAM1"     "CCL2"       "DUSP5"      "SLC40A1"    "PTGDR2"    </span></span>
<span><span class="co"># [236] "ITGB8"      "SAT1"       "S100A6"     "IFNB1"      "IGFBP7"    </span></span>
<span><span class="co"># [241] "TCL1A"      "S100P"      "DST"        "IFI27"      "H4C3"      </span></span>
<span><span class="co"># [246] "MMP16"      "CX3CL1"     "CALM3"      "DUSP6"      "IL36G"     </span></span>
<span><span class="co"># [251] "COL6A2"     "SOX4"       "TNFRSF10B"  "CCL19"      "KRT19"     </span></span>
<span><span class="co"># [256] "ACE"        "TPM2"       "FGF9"       "COL1A2"     "RAC1"      </span></span>
<span><span class="co"># [261] "RPL21"      "IL15RA"     "HMGN2"      "VEGFA"      "CDKN1A"    </span></span>
<span><span class="co"># [266] "COL18A1"    "IGF1"       "SLPI"       "FLT1"       "CD9"       </span></span>
<span><span class="co"># [271] "KRT5"       "TNFRSF12A"  "MIF"        "YBX3"       "S100A4"    </span></span>
<span><span class="co"># [276] "HPGDS"      "INHA"       "IGHG1"      "CLEC12A"    "NPPC"      </span></span>
<span><span class="co"># [281] "KRT8"       "IFNL2"      "TPSAB1"     "ATR"        "SMAD3"     </span></span>
<span><span class="co"># [286] "TUBB"       "KRT7"       "TBX21"      "CTNNB1"     "IRF4"      </span></span>
<span><span class="co"># [291] "DMBT1"      "ACKR4"      "SPARCL1"    "POU5F1"     "IRF3"      </span></span>
<span><span class="co"># [296] "MMP7"       "RXRA"       "TNFRSF11B"  "IL12A"      "DDR1"      </span></span>
<span><span class="co"># [301] "IL1RAP"     "ITGAM"      "DDIT3"      "TWIST1"     "NLRP2"     </span></span>
<span><span class="co"># [306] "LDLR"       "CXCL10"     "SAA2"       "KRT23"      "CAV1"      </span></span>
<span><span class="co"># [311] "IL1A"       "B2M"        "ELANE"      "TEK"        "ITGAV"     </span></span>
<span><span class="co"># [316] "FKBP11"     "ICAM3"      "TNFSF10"    "ERBB3"      "ADGRG6"    </span></span>
<span><span class="co"># [321] "CD80"       "CPA3"       "CTSW"       "MAML2"      "PHLDA2"    </span></span>
<span><span class="co"># [326] "LIFR"       "IL13RA1"    "HILPDA"     "KLF2"       "EPHA7"     </span></span>
<span><span class="co"># [331] "IL18"       "COL1A1"     "GLUL"       "DDR2"       "TM4SF1"    </span></span>
<span><span class="co"># [336] "KRT6C"      "COL5A2"     "CLEC10A"    "CSHL1"      "IL2RB"     </span></span>
<span><span class="co"># [341] "TPSB2"      "ITK"        "C1QC"       "CXCL16"     "IFNA1"     </span></span>
<span><span class="co"># [346] "IFNAR1"     "IGF2"       "ATG5"       "NKG7"       "RARRES2"   </span></span>
<span><span class="co"># [351] "AZU1"       "CLEC4A"     "GSTP1"      "GPBAR1"     "TNFRSF1A"  </span></span>
<span><span class="co"># [356] "IFITM3"     "DUSP1"      "CCR10"      "EPHB2"      "ITGA6"     </span></span>
<span><span class="co"># [361] "CAMP"       "CD14"       "TXK"        "SERPINH1"   "NPR3"      </span></span>
<span><span class="co"># [366] "MTOR"       "CRP"        "MMP2"       "IGF2R"      "TAGLN"     </span></span>
<span><span class="co"># [371] "PSAP"       "MS4A1"      "MST1R"      "KLRK1"      "BGN"       </span></span>
<span><span class="co"># [376] "TNFRSF9"    "P2RY12"     "PTK2"       "IL23A"      "RXRB"      </span></span>
<span><span class="co"># [381] "NOTCH3"     "FOXF1"      "COL15A1"    "SQSTM1"     "CCL15"     </span></span>
<span><span class="co"># [386] "S100A2"     "MMP3"       "CCL8"       "ESR1"       "SMARCB1"   </span></span>
<span><span class="co"># [391] "RGCC"       "PPARA"      "IL2RA"      "SMAD4"      "EFNA4"     </span></span>
<span><span class="co"># [396] "RARRES1"    "COL3A1"     "ITGB6"      "CD74"       "ANXA4"     </span></span>
<span><span class="co"># [401] "SFN"        "ARHGDIB"    "TNFRSF10A"  "VEGFC"      "HLA-B"     </span></span>
<span><span class="co"># [406] "HLA-DRB5"   "CD3D"       "ITGA1"      "ANGPT1"     "KRT24"     </span></span>
<span><span class="co"># [411] "MET"        "MALAT1"     "HSP90AB1"   "ABL2"       "LTF"       </span></span>
<span><span class="co"># [416] "MMP12"      "ACKR1"      "MERTK"      "S100A9"     "FZD8"      </span></span>
<span><span class="co"># [421] "INS"        "CD33"       "HDAC3"      "OSM"        "CYP1B1"    </span></span>
<span><span class="co"># [426] "ITGB2"      "CD40LG"     "CALD1"      "CLOCK"      "COL11A1"   </span></span>
<span><span class="co"># [431] "C9orf16"    "IL1B"       "CCL11"      "FGF18"      "BID"       </span></span>
<span><span class="co"># [436] "MT1X"       "KLK3"       "CCL28"      "RAMP3"      "OXER1"     </span></span>
<span><span class="co"># [441] "IL3RA"      "ADGRB3"     "FASN"       "MMP8"       "ITGA2"     </span></span>
<span><span class="co"># [446] "CCL5"       "MRC1"       "IGFBP5"     "PPARG"      "G6PD"      </span></span>
<span><span class="co"># [451] "CCND1"      "TLR2"       "RAMP2"      "PTPRC"      "BIRC5"     </span></span>
<span><span class="co"># [456] "ITM2A"      "IL11RA"     "STAT5A"     "COL27A1"    "PPARD"     </span></span>
<span><span class="co"># [461] "FFAR4"      "ADGRE5"     "FGF7"       "MMP14"      "MZB1"      </span></span>
<span><span class="co"># [466] "NOSIP"      "TNFRSF19"   "ADGRL2"     "FABP5"      "IFNGR1"    </span></span>
<span><span class="co"># [471] "VTN"        "FCER1G"     "CASP8"      "ITGB1"      "SOX2"      </span></span>
<span><span class="co"># [476] "GNLY"       "CCRL2"      "RSPO3"      "IGF1R"      "NOTCH2"    </span></span>
<span><span class="co"># [481] "IL10RA"     "TWIST2"     "LMNA"       "LCN2"       "PSCA"      </span></span>
<span><span class="co"># [486] "ADGRG2"     "AKT1"       "SPRY4"      "SELL"       "PDGFD"     </span></span>
<span><span class="co"># [491] "LYN"        "WNT11"      "IFNAR2"     "TNFRSF14"   "OASL"      </span></span>
<span><span class="co"># [496] "SNAI2"      "OLFM4"      "CYTOR"      "CXCR6"      "RARA"      </span></span>
<span><span class="co"># [501] "RUNX3"      "WNT3"       "PIGR"       "PDCD1"      "RGS2"      </span></span>
<span><span class="co"># [506] "LEFTY2"     "TLR5"       "CDKN3"      "ACVRL1"     "FZD4"      </span></span>
<span><span class="co"># [511] "FGF2"       "SMO"        "AHR"        "SELPLG"     "HDAC5"     </span></span>
<span><span class="co"># [516] "GATA3"      "CD81"       "PNOC"       "PLAC8"      "HLA-DPA1"  </span></span>
<span><span class="co"># [521] "MXRA8"      "CXCR1"      "SNAI1"      "KLRB1"      "IFNG"      </span></span>
<span><span class="co"># [526] "COL17A1"    "IL7"        "LUM"        "MMP1"       "IL22RA1"   </span></span>
<span><span class="co"># [531] "ITGB5"      "IL33"       "LYZ"        "FFAR3"      "SOD2"      </span></span>
<span><span class="co"># [536] "HCK"        "CCR1"       "UCP1"       "WNT10B"     "OXGR1"     </span></span>
<span><span class="co"># [541] "FGG"        "BST1"       "RELT"       "WNT5B"      "IL12RB2"   </span></span>
<span><span class="co"># [546] "DUSP2"      "HBB"        "CD83"       "CLEC2D"     "CSF2RB"    </span></span>
<span><span class="co"># [551] "HDAC11"     "IL17RE"     "COL5A3"     "WNT7B"      "TSLP"      </span></span>
<span><span class="co"># [556] "CALM1"      "IL2RG"      "CLEC4D"     "ADGRL1"     "APP"       </span></span>
<span><span class="co"># [561] "KRT20"      "CCL4L2"     "CD68"       "VIM"        "H2AZ1"     </span></span>
<span><span class="co"># [566] "LINC02446"  "BAX"        "CD34"       "FZD6"       "CEACAM6"   </span></span>
<span><span class="co"># [571] "ST6GALNAC3" "PTGS1"      "TNFSF8"     "VEGFD"      "ADGRF5"    </span></span>
<span><span class="co"># [576] "HSD3B2"     "COL9A2"     "KRT16"      "PDGFB"      "FYB1"      </span></span>
<span><span class="co"># [581] "CASP3"      "BRCA1"      "CXCL9"      "CLEC1A"     "IL20RA"    </span></span>
<span><span class="co"># [586] "HSPA1B"     "LEP"        "GCG"        "LY6D"       "DUSP4"     </span></span>
<span><span class="co"># [591] "CD59"       "EPHA3"      "RORA"       "WNT2"       "ADGRA2"    </span></span>
<span><span class="co"># [596] "CALM2"      "CLEC7A"     "HLA-C"      "TNFSF4"     "TYMS"      </span></span>
<span><span class="co"># [601] "IFITM1"     "MT2A"       "SMAD2"      "KRT17"      "PTK6"      </span></span>
<span><span class="co"># [606] "OSMR"       "CHEK1"      "CD79A"      "CASR"       "SPRY2"     </span></span>
<span><span class="co"># [611] "IGHM"       "S100B"      "GDF6"       "TNFSF9"     "IL34"      </span></span>
<span><span class="co"># [616] "DLL1"       "SPOCK2"     "NRXN1"      "CSF1"       "IL6ST"     </span></span>
<span><span class="co"># [621] "HDAC4"      "TOP2A"      "GAS6"       "ITGA5"      "COL5A1"    </span></span>
<span><span class="co"># [626] "ST6GAL1"    "TNFRSF1B"   "EMP3"       "TNFRSF13B"  "KRT6B"     </span></span>
<span><span class="co"># [631] "ABL1"       "CTLA4"      "EPOR"       "SLC2A4"     "MMP9"      </span></span>
<span><span class="co"># [636] "IL24"       "CHI3L1"     "PTGDS"      "CD209"      "RPL37"     </span></span>
<span><span class="co"># [641] "CD38"       "GPNMB"      "STAT5B"     "ETS1"       "DDC"       </span></span>
<span><span class="co"># [646] "LGALS1"     "KRT18"      "MYL9"       "EFNB3"      "ANXA1"     </span></span>
<span><span class="co"># [651] "BST2"       "COL4A1"     "GSN"        "CD58"       "CD55"      </span></span>
<span><span class="co"># [656] "PTPRCAP"    "VCAM1"      "ACVR1"      "IL12B"      "RB1"       </span></span>
<span><span class="co"># [661] "C11orf96"   "XCL2"       "SPINK1"     "C1QA"       "ITGAX"     </span></span>
<span><span class="co"># [666] "TNFRSF21"   "JAK1"       "IL17RB"     "IFNL3"      "HLA-DQA1"  </span></span>
<span><span class="co"># [671] "ETV5"       "TNFSF12"    "TIGIT"      "ENTPD1"     "RSPO2"     </span></span>
<span><span class="co"># [676] "ANGPT4"     "TLR4"       "EPHB3"      "ICOSLG"     "NRIP3"     </span></span>
<span><span class="co"># [681] "MARCO"      "NLRC4"      "CCL13"      "CIITA"      "OAS1"      </span></span>
<span><span class="co"># [686] "HBA1"       "EFNB2"      "HLA-DRB1"   "ADGRF3"     "TUBB4B"    </span></span>
<span><span class="co"># [691] "MAF"        "TSHZ2"      "SPP1"       "IL2"        "CALB1"     </span></span>
<span><span class="co"># [696] "CCL7"       "ADGRE1"     "XCL1"       "PDGFRA"     "CXCL17"    </span></span>
<span><span class="co"># [701] "STAT6"      "SLC2A1"     "COL8A1"     "SST"        "PTGES"     </span></span>
<span><span class="co"># [706] "LAG3"       "CCL18"      "CIDEA"      "BMP4"       "CXCL8"     </span></span>
<span><span class="co"># [711] "EGFR"       "KRT4"       "DNMT3A"     "FLT3LG"     "HLA-E"     </span></span>
<span><span class="co"># [716] "FZD7"       "OAS3"       "COL9A3"     "TLR1"       "APOD"      </span></span>
<span><span class="co"># [721] "ICAM2"      "PDGFA"      "PRF1"       "TFEB"       "AREG"      </span></span>
<span><span class="co"># [726] "ARG1"       "IL27RA"     "TNFRSF10D"  "GADD45B"    "HSP90AA1"  </span></span>
<span><span class="co"># [731] "DPP4"       "MMP19"      "TPM1"       "P2RX5"      "CST7"      </span></span>
<span><span class="co"># [736] "BEST1"      "MMP10"      "CXCR5"      "PTTG1"      "TOX"       </span></span>
<span><span class="co"># [741] "CDH11"      "MYC"        "PDGFRB"     "ANGPTL1"    "ADGRF4"    </span></span>
<span><span class="co"># [746] "AHI1"       "HLA-DPB1"   "TNFRSF11A"  "TNFSF15"    "AR"        </span></span>
<span><span class="co"># [751] "IL1R1"      "CCL20"      "NLRC5"      "HAVCR2"     "LTBR"      </span></span>
<span><span class="co"># [756] "GDF3"       "TAP2"       "INSR"       "IL15"       "HSD17B2"   </span></span>
<span><span class="co"># [761] "CD84"       "MPO"        "SELENOP"    "SEC23A"     "DHRS2"     </span></span>
<span><span class="co"># [766] "HSP90B1"    "HSPA1A"     "BCL2"       "XBP1"       "RBPJ"      </span></span>
<span><span class="co"># [771] "EZH2"       "MSMB"       "EFNA5"      "AXL"        "NLRP3"     </span></span>
<span><span class="co"># [776] "FN1"        "CD8B"       "CXCR2"      "CNTFR"      "TNFRSF18"  </span></span>
<span><span class="co"># [781] "COL6A3"     "CCR5"       "NRG4"       "ITGB4"      "CSF2"      </span></span>
<span><span class="co"># [786] "TLR3"       "IGHD"       "CD70"       "INHBB"      "MAPK13"    </span></span>
<span><span class="co"># [791] "MEG3"       "PLA2R1"     "MAP1LC3B"   "PPBP"       "IL17D"     </span></span>
<span><span class="co"># [796] "CD4"        "IL20"       "IL17B"      "KRT15"      "RPL22"     </span></span>
<span><span class="co"># [801] "RYK"        "NTRK2"      "CCL21"      "DDX58"      "CD24"      </span></span>
<span><span class="co"># [806] "IL10"       "PARP1"      "CD300A"     "CDH5"       "BTG1"      </span></span>
<span><span class="co"># [811] "NFKBIA"     "PRSS2"      "CXCL6"      "CSF2RA"     "ADGRD1"    </span></span>
<span><span class="co"># [816] "WNT9A"      "ADIRF"      "ICOS"       "KRT6A"      "CD86"      </span></span>
<span><span class="co"># [821] "C5AR2"      "FOS"        "SCG5"       "IFNGR2"     "LGALS3BP"  </span></span>
<span><span class="co"># [826] "CD69"       "RGS5"       "BMP2"       "BMP5"       "RELA"      </span></span>
<span><span class="co"># [831] "CLCF1"      "COL4A5"     "BMPR2"      "FCGR3A"     "REG1A"     </span></span>
<span><span class="co"># [836] "EZR"        "IL12RB1"    "RAC2"       "C1QB"       "RNF43"     </span></span>
<span><span class="co"># [841] "CLEC4E"     "PCNA"       "CLEC5A"     "FABP4"      "PGR"       </span></span>
<span><span class="co"># [846] "CD163"      "ICAM1"      "ADGRG1"     "HTT"        "CD47"      </span></span>
<span><span class="co"># [851] "AQP3"       "OAS2"       "GPR183"     "LEFTY1"     "WNT2B"     </span></span>
<span><span class="co"># [856] "BMX"        "JAG1"       "PTGIS"      "EPHB6"      "NPR2"      </span></span>
<span><span class="co"># [861] "SREBF1"     "CD40"       "DNTT"       "IL16"       "IFIT1"     </span></span>
<span><span class="co"># [866] "ANGPT2"     "PTGES2"     "DNMT1"      "GZMB"       "TSC22D1"   </span></span>
<span><span class="co"># [871] "HCAR3"      "FGF12"      "HGF"        "BMP1"       "ENG"       </span></span>
<span><span class="co"># [876] "CXCL5"      "B3GNT7"     "ADM2"       "CLEC14A"    "ARF1"      </span></span>
<span><span class="co"># [881] "ACVR1B"     "GC"         "AATK"       "ARTN"       "ADGRA3"    </span></span>
<span><span class="co"># [886] "FFAR2"      "TNF"        "S100A8"     "BATF3"      "SIGIRR"    </span></span>
<span><span class="co"># [891] "VPREB3"     "BECN1"      "FZD1"       "PROK2"      "NCR1"      </span></span>
<span><span class="co"># [896] "IL17RA"     "IL1R2"      "CPB1"       "JAK2"       "IL6R"      </span></span>
<span><span class="co"># [901] "NANOG"      "CYP19A1"    "NPPB"       "PGF"        "FPR1"      </span></span>
<span><span class="co"># [906] "NR1H2"      "NRXN3"      "NOTCH1"     "NR3C1"      "KRT10"     </span></span>
<span><span class="co"># [911] "SERPINB5"   "CSK"        "ADGRB2"     "CELSR1"     "GPER1"     </span></span>
<span><span class="co"># [916] "RPS4Y1"     "HMGB2"      "BMPR1A"     "PDCD1LG2"   "TNFRSF4"   </span></span>
<span><span class="co"># [921] "GZMK"       "FGFR1"      "GDF9"       "SOSTDC1"    "TNFSF14"   </span></span>
<span><span class="co"># [926] "NGFR"       "UPK3A"      "CCL3L3"     "BAG3"       "LY75"      </span></span>
<span><span class="co"># [931] "ADGRL4"     "TTR"        "NPR1"       "VEGFB"      "NRG1"      </span></span>
<span><span class="co"># [936] "AZGP1"      "PROKR1"     "CXCR3"      "STAT4"      "ETV4"      </span></span>
<span><span class="co"># [941] "ATM"        "TNFRSF17"   "APOB"       "ADGRE2"     "COL21A1"   </span></span>
<span><span class="co"># [946] "CX3CR1"     "CMKLR1"     "MS4A4A"     "COL9A1"     "TNFSF13B"  </span></span>
<span><span class="co"># [951] "SOD1"       "ACTG2"      "TP53"       "ADGRV1"     "IAPP"      </span></span>
<span><span class="co"># [956] "CCL26"      "CXCL14"     "CHGA"       "CXCL12"     "CEACAM1"  </span></span></code></pre></div>
<div class="section level4">
<h4 id="preview-negative-probes-optional">2.2.1 Preview negative probes (optional)<a class="anchor" aria-label="anchor" href="#preview-negative-probes-optional"></a>
</h4>
<p>Previewing the probe information can be done by converting to
<code>giottoPoints</code> and then using <code><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot()</a></code>. Here we
show a preview of the negative probes.</p>
<p><strong>Note:</strong> if previewing the rna expression information,
it is highly recommended to set a subset of features using the
<code>feats</code> param. The default is to plot all points, which can
be very slow for large data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neg_points</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/createGiottoPoints.html">createGiottoPoints</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">neg_coords_all</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">target</span>, <span class="va">x_global_px</span>, <span class="va">y_global_px</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">neg_points</span>, point_size <span class="op">=</span> <span class="fl">0.2</span>, feats <span class="op">=</span> <span class="va">neg_IDs</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/preview_negprb.png"></p>
</div>
</div>
<div class="section level3">
<h3 id="fov-shifts">2.3 FOV shifts<a class="anchor" aria-label="anchor" href="#fov-shifts"></a>
</h3>
<p><code>fov_positions_file.csv</code> contains information on the x and
y shifts needed in order to put the FOVs tiles together into a cohesive
whole. This information is needed during the image attachment and
alignment process.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  load field of vision (fov) positions</span></span>
<span><span class="va">fov_offset_file</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">'Lung12_fov_positions_file.csv'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#     fov x_global_px y_global_px</span></span>
<span><span class="co">#  1:   1  -4977.7778   -160233.3</span></span>
<span><span class="co">#  2:   2    494.4444   -160233.3</span></span>
<span><span class="co">#  3:   3   5966.6667   -160233.3</span></span>
<span><span class="co">#  4:   4  11438.8889   -160233.3</span></span>
<span><span class="co">#  5:   5  -4977.7778   -156583.3</span></span>
<span><span class="co">#  6:   6    494.4444   -156583.3</span></span>
<span><span class="co">#  7:   7   5966.6667   -156583.3</span></span>
<span><span class="co">#  8:   8  11438.8889   -156583.3</span></span>
<span><span class="co">#  9:   9  -4977.7778   -152933.3</span></span>
<span><span class="co"># 10:  10    494.4444   -152933.3</span></span>
<span><span class="co"># 11:  11   5966.6667   -152933.3</span></span>
<span><span class="co"># 12:  12  11438.8889   -152933.3</span></span>
<span><span class="co"># 13:  13  -4977.7778   -149283.3</span></span>
<span><span class="co"># 14:  14    494.4444   -149283.3</span></span>
<span><span class="co"># 15:  15   5966.6667   -149283.3</span></span>
<span><span class="co"># 16:  16  11438.8889   -149283.3</span></span>
<span><span class="co"># 17:  17  -4977.7778   -145633.3</span></span>
<span><span class="co"># 18:  18    494.4444   -145633.3</span></span>
<span><span class="co"># 19:  19   5966.6667   -145633.3</span></span>
<span><span class="co"># 20:  20  11438.8889   -145633.3</span></span>
<span><span class="co"># 21:  21  -4977.7778   -141983.3</span></span>
<span><span class="co"># 22:  22    494.4444   -141983.3</span></span>
<span><span class="co"># 23:  23   5966.6667   -141983.3</span></span>
<span><span class="co"># 24:  24  11438.8889   -141983.3</span></span>
<span><span class="co"># 25:  25  -4977.7778   -138333.3</span></span>
<span><span class="co"># 26:  26    494.4444   -138333.3</span></span>
<span><span class="co"># 27:  27   5966.6667   -138333.3</span></span>
<span><span class="co"># 28:  28  11438.8889   -138333.3</span></span>
<span><span class="co">#     fov x_global_px y_global_px</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="choose-field-of-view-for-analysis">2.4 Choose field of view for analysis<a class="anchor" aria-label="anchor" href="#choose-field-of-view-for-analysis"></a>
</h3>
<p>CosMx data is large and Giotto loads in the subcellular information
by FOV. This dataset includes 28 FOVs which can be difficult for most
computers to handle at once.</p>
<p>This tutorial will use FOVs â€˜02â€™, â€˜03â€™, and â€˜04â€™ which correspond to
the 3 FOVs visible on the bottom right in the negative probe preview
above.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gobjects_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">id_set</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'02'</span>, <span class="st">'03'</span>, <span class="st">'04'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="create-a-giotto-object-for-each-fov">3. Create a Giotto Object for each FOV<a class="anchor" aria-label="anchor" href="#create-a-giotto-object-for-each-fov"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">fov_i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">id_set</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">fov_id</span> <span class="op">=</span> <span class="va">id_set</span><span class="op">[</span><span class="va">fov_i</span><span class="op">]</span></span>
<span></span>
<span></span>
<span>  <span class="co"># 1. original composite image as png</span></span>
<span>  <span class="va">original_composite_image</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">'CellComposite/CellComposite_F0'</span>, <span class="va">fov_id</span>,<span class="st">'.jpg'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># 2. input cell segmentation as mask file</span></span>
<span>  <span class="va">segmentation_mask</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">'CellLabels/CellLabels_F0'</span>, <span class="va">fov_id</span>, <span class="st">'.tif'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># 3. input features coordinates + offset</span></span>
<span>  <span class="va">feat_coord</span> <span class="op">=</span> <span class="va">feat_coords_all</span><span class="op">[</span><span class="va">fov</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fov_id</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">neg_coord</span> <span class="op">=</span> <span class="va">neg_coords_all</span><span class="op">[</span><span class="va">fov</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fov_id</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">feat_coord</span> <span class="op">=</span> <span class="va">feat_coord</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x_local_px</span>, <span class="va">y_local_px</span>, <span class="va">z</span>, <span class="va">target</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">neg_coord</span> <span class="op">=</span> <span class="va">neg_coord</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x_local_px</span>, <span class="va">y_local_px</span>, <span class="va">z</span>, <span class="va">target</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/row-plus-colnames-generic.html">colnames</a></span><span class="op">(</span><span class="va">feat_coord</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'z'</span>, <span class="st">'gene_id'</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/row-plus-colnames-generic.html">colnames</a></span><span class="op">(</span><span class="va">neg_coord</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'z'</span>, <span class="st">'gene_id'</span><span class="op">)</span></span>
<span>  <span class="va">feat_coord</span> <span class="op">=</span> <span class="va">feat_coord</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">gene_id</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">neg_coord</span> <span class="op">=</span> <span class="va">neg_coord</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">gene_id</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span>  <span class="va">fovsubset</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/createGiottoObjectSubcellular.html">createGiottoObjectSubcellular</a></span><span class="op">(</span></span>
<span>    gpoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'rna'</span> <span class="op">=</span> <span class="va">feat_coord</span>,</span>
<span>                   <span class="st">'neg_probe'</span> <span class="op">=</span> <span class="va">neg_coord</span><span class="op">)</span>,</span>
<span>    gpolygons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'cell'</span> <span class="op">=</span> <span class="va">segmentation_mask</span><span class="op">)</span>,</span>
<span>    polygon_mask_list_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      mask_method <span class="op">=</span> <span class="st">'guess'</span>,</span>
<span>      flip_vertical <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      flip_horizontal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      shift_horizontal_step <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span>,</span>
<span>    instructions <span class="op">=</span> <span class="va">instrs</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co"># cell centroids are now used to provide the spatial locations</span></span>
<span>  <span class="va">fovsubset</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/addSpatialCentroidLocations.html">addSpatialCentroidLocations</a></span><span class="op">(</span><span class="va">fovsubset</span>,</span>
<span>                                          poly_info <span class="op">=</span> <span class="st">'cell'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># create and add Giotto images</span></span>
<span>  <span class="va">composite</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/createGiottoLargeImage.html">createGiottoLargeImage</a></span><span class="op">(</span>raster_object <span class="op">=</span> <span class="va">original_composite_image</span>,</span>
<span>                                     negative_y <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                     name <span class="op">=</span> <span class="st">'composite'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">fovsubset</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/addGiottoImage.html">addGiottoImage</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fovsubset</span>,</span>
<span>                             largeImages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">composite</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">fovsubset</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/convertGiottoLargeImageToMG.html">convertGiottoLargeImageToMG</a></span><span class="op">(</span>giottoLargeImage <span class="op">=</span> <span class="va">composite</span>,</span>
<span>                                          <span class="co">#mg_name = 'composite',</span></span>
<span>                                          gobject <span class="op">=</span> <span class="va">fovsubset</span>,</span>
<span>                                          return_gobject <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">gobjects_list</span><span class="op">[[</span><span class="va">fov_i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">fovsubset</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="join-fov-giotto-objects">4. Join FOV Giotto Objects<a class="anchor" aria-label="anchor" href="#join-fov-giotto-objects"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"fov0"</span>, <span class="va">id_set</span><span class="op">)</span></span>
<span></span>
<span><span class="va">id_match</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">id_set</span><span class="op">)</span>, <span class="va">fov_offset_file</span><span class="op">$</span><span class="va">fov</span><span class="op">)</span></span>
<span><span class="va">x_shifts</span> <span class="op">=</span> <span class="va">fov_offset_file</span><span class="op">[</span><span class="va">id_match</span><span class="op">]</span><span class="op">$</span><span class="va">x_global_px</span></span>
<span><span class="va">y_shifts</span> <span class="op">=</span> <span class="va">fov_offset_file</span><span class="op">[</span><span class="va">id_match</span><span class="op">]</span><span class="op">$</span><span class="va">y_global_px</span></span>
<span></span>
<span><span class="co"># Create Giotto object that includes all selected FOVs</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/joinGiottoObjects.html">joinGiottoObjects</a></span><span class="op">(</span>gobject_list <span class="op">=</span> <span class="va">gobjects_list</span>,</span>
<span>                             gobject_names <span class="op">=</span> <span class="va">new_names</span>,</span>
<span>                             join_method <span class="op">=</span> <span class="st">'shift'</span>,</span>
<span>                             x_shift <span class="op">=</span> <span class="va">x_shifts</span>,</span>
<span>                             y_shift <span class="op">=</span> <span class="va">y_shifts</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sec-objdone">5. Visualize Cells and Genes of Interest<a class="anchor" aria-label="anchor" href="#sec-objdone"></a>
</h2>
<p>When plotting subcellular data, Giotto uses the
<code>spatInSituPlot</code> functions. Spatial plots showing the feature
points and polygons are plotted using
<code><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/showGiottoImageNames.html">showGiottoImageNames</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up vector of image names</span></span>
<span><span class="va">id_set</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'02'</span>, <span class="st">'03'</span>, <span class="st">'04'</span><span class="op">)</span></span>
<span><span class="va">new_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"fov0"</span>, <span class="va">id_set</span><span class="op">)</span></span>
<span><span class="va">image_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">new_names</span>, <span class="st">'-image'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                     show_image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     image_name <span class="op">=</span> <span class="va">image_names</span>,</span>
<span>                     feats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'rna'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'MMP2'</span>, <span class="st">'VEGFA'</span>, <span class="st">'IGF1R'</span>,</span>
<span>                                            <span class="st">'MKI67'</span>, <span class="st">'EPCAM'</span>, <span class="st">'KRT8'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     feats_color_code <span class="op">=</span> <span class="va">viv10</span>,</span>
<span>                     spat_unit <span class="op">=</span> <span class="st">'cell'</span>,</span>
<span>                     point_size <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     use_overlap <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     polygon_feat_type <span class="op">=</span> <span class="st">'cell'</span>,</span>
<span>                     polygon_color <span class="op">=</span> <span class="st">'white'</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                       save_name <span class="op">=</span> <span class="st">'1_inSituFeats'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/1_inSituFeats.png"></p>
<div class="section level3">
<h3 id="visualize-cell-centroids">5.1 Visualize Cell Centroids<a class="anchor" aria-label="anchor" href="#visualize-cell-centroids"></a>
</h3>
<p>The standard <code><a href="https://drieslab.github.io/Giotto/reference/spatPlot.html">spatPlot2D()</a></code> function can also be used, but
this works off only the aggregated information that is assembled based
on the subcellular information. Plotting information based on cell
centroids can be done through this function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatPlot.html">spatPlot2D</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>           image_name <span class="op">=</span> <span class="va">image_names</span>,</span>
<span>           show_image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           point_shape <span class="op">=</span> <span class="st">'no_border'</span>,</span>
<span>           point_size <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>           point_alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>           coord_fix_ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>           save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                             save_name <span class="op">=</span> <span class="st">'2_spatCentroids'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/2_spatCentroids.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="aggregate-subcellular-features">6. Aggregate subcellular features<a class="anchor" aria-label="anchor" href="#aggregate-subcellular-features"></a>
</h2>
<p>Giotto supports working directly with the subcellular features in
order to generate cell by feature matrices. The data generated this way
is then given the spatial unit <code>'cell'</code>. This workflow is
recommended over loading the provided cell by feature (aggregated
expression) matrix and then including the subcellular information as
secondary data.</p>
<p>When both the raw subcellular information and the pre-made expression
matrix are loaded in at the same time, the subcellular data and all data
generated from it should be given the spatial unit <code>'cell'</code>
and the pre-generated aggregated information should be given a different
spatial unit such as <code>'cell_agg'</code> to differentiate between
the two sources of information.</p>
<p>In this step, we will be aggregating the feature points of
<code>'rna'</code> and <code>'neg_probe'</code> into the
<code>'cell'</code> spatial unit.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the feature points overlapped by polygons. This overlap information is then</span></span>
<span><span class="co"># returned to the relevant giottoPolygon object's overlaps slot.</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/calculateOverlapRaster.html">calculateOverlapRaster</a></span><span class="op">(</span><span class="va">fov_join</span>, feat_info <span class="op">=</span> <span class="st">'rna'</span><span class="op">)</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/calculateOverlapRaster.html">calculateOverlapRaster</a></span><span class="op">(</span><span class="va">fov_join</span>, feat_info <span class="op">=</span> <span class="st">'neg_probe'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the overlap information into a cell by feature expression matrix which</span></span>
<span><span class="co"># is then stored in the Giotto object's expression slot</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/overlapToMatrix.html">overlapToMatrix</a></span><span class="op">(</span><span class="va">fov_join</span>, feat_info <span class="op">=</span> <span class="st">'rna'</span><span class="op">)</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/overlapToMatrix.html">overlapToMatrix</a></span><span class="op">(</span><span class="va">fov_join</span>, feat_info <span class="op">=</span> <span class="st">'neg_probe'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/showGiottoExpression.html">showGiottoExpression</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># â””â”€â”€Spatial unit "cell"</span></span>
<span><span class="co">#    â”œâ”€â”€Feature type "rna"</span></span>
<span><span class="co">#    â”‚  â””â”€â”€Expression data "raw" values:</span></span>
<span><span class="co">#    â”‚        An object of class exprObj </span></span>
<span><span class="co">#    â”‚        for spatial unit: "cell" and feature type: "rna" </span></span>
<span><span class="co">#    â”‚          Provenance:  cell </span></span>
<span><span class="co">#    â”‚        </span></span>
<span><span class="co">#    â”‚        contains:</span></span>
<span><span class="co">#    â”‚        960 x 8066 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#    â”‚                                              </span></span>
<span><span class="co">#    â”‚        LY6D  . . 1 . . . . . . . . . . ......</span></span>
<span><span class="co">#    â”‚        IGHA1 . . . . . . . 2 . 1 . . . ......</span></span>
<span><span class="co">#    â”‚        VWF   . . . 1 . . . . . 1 . . . ......</span></span>
<span><span class="co">#    â”‚        </span></span>
<span><span class="co">#    â”‚         ........suppressing 8053 columns and 954 rows </span></span>
<span><span class="co">#    â”‚                                               </span></span>
<span><span class="co">#    â”‚        CLEC2D 1 . . . . . . . . 1 . . . ......</span></span>
<span><span class="co">#    â”‚        MARCO  . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#    â”‚        AATK   . . . . . . . . . . . . 2 ......</span></span>
<span><span class="co">#    â”‚        </span></span>
<span><span class="co">#    â”‚         First four colnames:</span></span>
<span><span class="co">#    â”‚         fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#    â”‚         fov002-cell_3 fov002-cell_4 </span></span>
<span><span class="co">#    â”‚     </span></span>
<span><span class="co">#    â””â”€â”€Feature type "neg_probe"</span></span>
<span><span class="co">#       â””â”€â”€Expression data "raw" values:</span></span>
<span><span class="co">#             An object of class exprObj </span></span>
<span><span class="co">#             for spatial unit: "cell" and feature type: "neg_probe" </span></span>
<span><span class="co">#               Provenance:  cell </span></span>
<span><span class="co">#             </span></span>
<span><span class="co">#             contains:</span></span>
<span><span class="co">#             20 x 8066 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#                                                      </span></span>
<span><span class="co">#             NegPrb8  . . . . . . . . . . 2 . . ......</span></span>
<span><span class="co">#             NegPrb10 1 . . . . . . . . . . . 1 ......</span></span>
<span><span class="co">#             NegPrb20 . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#             </span></span>
<span><span class="co">#              ........suppressing 8053 columns and 14 rows </span></span>
<span><span class="co">#                                                      </span></span>
<span><span class="co">#             NegPrb18 . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#             NegPrb12 . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#             NegPrb15 1 . 1 . . . . . . . . . . ......</span></span>
<span><span class="co">#             </span></span>
<span><span class="co">#              First four colnames:</span></span>
<span><span class="co">#              fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#              fov002-cell_3 fov002-cell_4 </span></span></code></pre></div>
<div class="section level3">
<h3 id="plot-histograms-of-total-counts-per-cell">6.1 Plot histograms of total counts per cell<a class="anchor" aria-label="anchor" href="#plot-histograms-of-total-counts-per-cell"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/filterDistributions.html">filterDistributions</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                    plot_type <span class="op">=</span> <span class="st">'hist'</span>,</span>
<span>                    detection <span class="op">=</span> <span class="st">'cells'</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">'sum'</span>,</span>
<span>                    feat_type <span class="op">=</span> <span class="st">'rna'</span>,</span>
<span>                    nr_bins <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                    save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                      save_name <span class="op">=</span> <span class="st">'3.1_totalexpr'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/filterDistributions.html">filterDistributions</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                    plot_type <span class="op">=</span> <span class="st">'hist'</span>,</span>
<span>                    detection <span class="op">=</span> <span class="st">'cells'</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">'sum'</span>,</span>
<span>                    feat_type <span class="op">=</span> <span class="st">'neg_probe'</span>,</span>
<span>                    nr_bins <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                    save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                      save_name <span class="op">=</span> <span class="st">'3.2_totalnegprbe'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>RNA</strong> <img src="images/nanostring_cosmx_lung_cancer/3.1_totalexpr.png"></p>
<p><strong>Negative Probes</strong> <img src="images/nanostring_cosmx_lung_cancer/3.2_totalnegprbe.png"></p>
</div>
<div class="section level3">
<h3 id="d-density-plots">6.2 2D Density Plots<a class="anchor" aria-label="anchor" href="#d-density-plots"></a>
</h3>
<p>Density-based representations may sometimes be preferred instead of
viewing the raw points information, especially when points are dense
enough that there is overplotting. After overlaps information has been
calculated, <code><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotDensity.html">spatInSituPlotDensity()</a></code> can be used in order to
get a general idea of how much expression there is of a feature.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotDensity.html">spatInSituPlotDensity</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                      feats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MMP2"</span>, <span class="st">"VEGFA"</span>, <span class="st">"IGF1R"</span>,</span>
<span>                                <span class="st">'MKI67'</span>, <span class="st">'EPCAM'</span>, <span class="st">'KRT8'</span><span class="op">)</span>,</span>
<span>                      cow_n_col <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                      save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                        save_name <span class="op">=</span> <span class="st">'4_inSituDens'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/4_inSituDens.png"></p>
</div>
<div class="section level3">
<h3 id="extract-data-from-giotto-object">6.3 Extract Data from Giotto Object<a class="anchor" aria-label="anchor" href="#extract-data-from-giotto-object"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine cell data</span></span>
<span><span class="va">morphometa</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/combineCellData.html">combineCellData</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                             feat_type <span class="op">=</span> <span class="st">'rna'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine feature data</span></span>
<span><span class="va">featmeta</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/combineFeatureData.html">combineFeatureData</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                              feat_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'rna'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine overlapping feature data</span></span>
<span><span class="va">featoverlapmeta</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/combineFeatureOverlapData.html">combineFeatureOverlapData</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                                            feat_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'rna'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># $rna</span></span>
<span><span class="co">#                  cell_ID    sdimx     sdimy geom part          x         y hole list_ID feat</span></span>
<span><span class="co">#       1:   fov002-cell_1  1025.82 -156627.0    1    1   979.4444 -156585.3    0  fov002  rna</span></span>
<span><span class="co">#       2:   fov002-cell_1  1025.82 -156627.0    1    1  1043.4444 -156585.3    0  fov002  rna</span></span>
<span><span class="co">#       3:   fov002-cell_1  1025.82 -156627.0    1    1  1043.4444 -156586.3    0  fov002  rna</span></span>
<span><span class="co">#       4:   fov002-cell_1  1025.82 -156627.0    1    1  1048.4444 -156586.3    0  fov002  rna</span></span>
<span><span class="co">#       5:   fov002-cell_1  1025.82 -156627.0    1    1  1048.4444 -156587.3    0  fov002  rna</span></span>
<span><span class="co">#      ---                                                                                    </span></span>
<span><span class="co"># 1280551: fov004-cell_999 15294.68 -158713.1 6378    1 15288.8889 -158685.3    0  fov004  rna</span></span>
<span><span class="co"># 1280552: fov004-cell_999 15294.68 -158713.1 6378    1 15292.8889 -158685.3    0  fov004  rna</span></span>
<span><span class="co"># 1280553: fov004-cell_999 15294.68 -158713.1 6378    1 15292.8889 -158683.3    0  fov004  rna</span></span>
<span><span class="co"># 1280554: fov004-cell_999 15294.68 -158713.1 6378    1 15298.8889 -158683.3    0  fov004  rna</span></span>
<span><span class="co"># 1280555: fov004-cell_999 15294.68 -158713.1 6378    1 15298.8889 -158681.3    0  fov004  rna</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># $rna</span></span>
<span><span class="co">#          feat_ID    geom part         x         y hole z fov  CellComp   feat_ID_uniq feat spat_unit</span></span>
<span><span class="co">#       1:    AATK   23962    1  3725.974 -160100.8    0 5   2  Membrane   fov002-23962  rna      cell</span></span>
<span><span class="co">#       2:    AATK   28924    1  3344.687 -158576.3    0 5   2  Membrane   fov002-28924  rna      cell</span></span>
<span><span class="co">#       3:    AATK   32363    1  4972.508 -158667.6    0 5   2         0   fov002-32363  rna      cell</span></span>
<span><span class="co">#       4:    AATK   37076    1  4502.724 -158180.0    0 5   2         0   fov002-37076  rna      cell</span></span>
<span><span class="co">#       5:    AATK   42621    1  2404.527 -158087.4    0 8   2         0   fov002-42621  rna      cell</span></span>
<span><span class="co">#      ---                                                                                            </span></span>
<span><span class="co"># 3331156:   ZFP36 3327938    1 16866.039 -160138.1    0 2   4   Nuclear fov004-1223368  rna      cell</span></span>
<span><span class="co"># 3331157:   ZFP36 3328013    1 16842.374 -160133.1    0 1   4   Nuclear fov004-1223443  rna      cell</span></span>
<span><span class="co"># 3331158:   ZFP36 3328281    1 16117.825 -160208.1    0 5   4 Cytoplasm fov004-1223711  rna      cell</span></span>
<span><span class="co"># 3331159:   ZFP36 3328522    1 12781.322 -160146.5    0 2   4   Nuclear fov004-1223952  rna      cell</span></span>
<span><span class="co"># 3331160:   ZFP36 3330762    1 16086.589 -160222.2    0 6   4   Nuclear fov004-1226192  rna      cell</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># $rna</span></span>
<span><span class="co">#          feat_ID    geom part         x         y hole          poly_ID   feat_ID_uniq poly_info feat</span></span>
<span><span class="co">#       1:    AATK   23962    1  3725.974 -160100.8    0             &lt;NA&gt;   fov002-23962      cell  rna</span></span>
<span><span class="co">#       2:    AATK   28924    1  3344.687 -158576.3    0             &lt;NA&gt;   fov002-28924      cell  rna</span></span>
<span><span class="co">#       3:    AATK   32363    1  4972.508 -158667.6    0 fov002-cell_1084   fov002-32363      cell  rna</span></span>
<span><span class="co">#       4:    AATK   37076    1  4502.724 -158180.0    0             &lt;NA&gt;   fov002-37076      cell  rna</span></span>
<span><span class="co">#       5:    AATK   42621    1  2404.527 -158087.4    0             &lt;NA&gt;   fov002-42621      cell  rna</span></span>
<span><span class="co">#      ---                                                                                             </span></span>
<span><span class="co"># 3331156:   ZFP36 3327938    1 16866.039 -160138.1    0 fov004-cell_2661 fov004-1223368      cell  rna</span></span>
<span><span class="co"># 3331157:   ZFP36 3328013    1 16842.374 -160133.1    0 fov004-cell_2661 fov004-1223443      cell  rna</span></span>
<span><span class="co"># 3331158:   ZFP36 3328281    1 16117.825 -160208.1    0 fov004-cell_2663 fov004-1223711      cell  rna</span></span>
<span><span class="co"># 3331159:   ZFP36 3328522    1 12781.322 -160146.5    0 fov004-cell_2664 fov004-1223952      cell  rna</span></span>
<span><span class="co"># 3331160:   ZFP36 3330762    1 16086.589 -160222.2    0 fov004-cell_2676 fov004-1226192      cell  rna</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sec-matcompare">6.4 Comparison of Giotto aggregated and Nanostring provided
matrices<a class="anchor" aria-label="anchor" href="#sec-matcompare"></a>
</h3>
<p>Comparison of Giottoâ€™s aggregated matrix results and those provided
by Nanostring. Only FOV2 will be used in this comparison. Matrices are
expected to be similar when the same sets of cell polygons/masks are
used for both.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load and prepare data</span></span>
<span></span>
<span><span class="va">nanoDT</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">'Lung12_exprMat_file.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">=</span> <span class="va">nanoDT</span><span class="op">[</span><span class="va">fov</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Set up cell_IDs</span></span>
<span><span class="va">test1</span><span class="op">[</span>, <span class="va">cell_ID</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'cell_'</span>, <span class="va">cell_ID</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">test1</span><span class="op">[</span>, <span class="va">cell_ID</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'f'</span>, <span class="va">fov</span>, <span class="st">'-'</span>, <span class="va">cell_ID</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">test1</span><span class="op">[</span>, <span class="va">fov</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="va">test1mat</span> <span class="op">=</span> <span class="fu">Giottot_flex</span><span class="op">(</span><span class="fu">Giottodt_to_matrix</span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">testnano_f2</span> <span class="op">=</span> <span class="va">test1mat</span></span>
<span><span class="co"># Remove cell_0 (all tx counts that do not fall within a polygon)</span></span>
<span><span class="va">testnano_f2</span> <span class="op">=</span> <span class="va">testnano_f2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Remove negative probe counts</span></span>
<span><span class="va">testnano_f2</span> <span class="op">=</span> <span class="va">testnano_f2</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'NegPrb'</span>, <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/row-plus-colnames-generic.html">rownames</a></span><span class="op">(</span><span class="va">testnano_f2</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># giotto matrix</span></span>
<span><span class="va">testg</span> <span class="op">=</span> <span class="va">fov_join</span><span class="op">@</span><span class="va">expression</span><span class="op">$</span><span class="va">cell</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">raw</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="va">testg_f2</span> <span class="op">=</span> <span class="va">testg</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'fov002'</span>, <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/row-plus-colnames-generic.html">colnames</a></span><span class="op">(</span><span class="va">testg</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sorted_rownames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/row-plus-colnames-generic.html">rownames</a></span><span class="op">(</span><span class="va">testg_f2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">testg_f2</span> <span class="op">=</span> <span class="va">testg_f2</span><span class="op">[</span><span class="va">sorted_rownames</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Prepare matrix comparison</span></span>
<span><span class="co"># Summarise sparse matrices (i and j are matrix indices, x is value)</span></span>
<span><span class="va">testg_f2_DT</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu">summary</span><span class="op">(</span><span class="va">testg_f2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">testg_f2_DT</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="st">'giotto'</span><span class="op">]</span></span>
<span><span class="va">testnano_f2_DT</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu">summary</span><span class="op">(</span><span class="va">testnano_f2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">testnano_f2_DT</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="st">'nanostring'</span><span class="op">]</span></span>
<span><span class="va">testDT</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">testg_f2_DT</span>, <span class="va">testnano_f2_DT</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Combine sparse matrix indices</span></span>
<span><span class="va">testDT</span><span class="op">[</span>, <span class="va">combo</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span>,<span class="st">'-'</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># matrix index similarity</span></span>
<span><span class="va">pl_n</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl_n</span> <span class="op">=</span> <span class="va">pl_n</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">testnano_f2_DT</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">i</span>, y <span class="op">=</span> <span class="va">j</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl_n</span> <span class="op">=</span> <span class="va">pl_n</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Nanostring Sparse Matrix'</span><span class="op">)</span></span>
<span><span class="va">pl_n</span> <span class="op">=</span> <span class="va">pl_n</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'blue'</span>, high <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span>
<span><span class="va">pl_n</span> <span class="op">=</span> <span class="va">pl_n</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pl_g</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl_g</span> <span class="op">=</span> <span class="va">pl_g</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">testg_f2_DT</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">i</span>, y <span class="op">=</span> <span class="va">j</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl_g</span> <span class="op">=</span> <span class="va">pl_g</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Giotto Sparse Matrix'</span><span class="op">)</span></span>
<span><span class="va">pl_g</span> <span class="op">=</span> <span class="va">pl_g</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'blue'</span>, high <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span>
<span><span class="va">pl_g</span> <span class="op">=</span> <span class="va">pl_g</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">combplot</span> <span class="op">=</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">pl_n</span>, <span class="va">pl_g</span>,</span>
<span>                              nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                              labels <span class="op">=</span> <span class="st">'AUTO'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">combplot</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/mat_comparison.png"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># directly compare differences in matrix values (counts assigned)</span></span>
<span><span class="va">vartestDT</span> <span class="op">=</span> <span class="va">testDT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">i</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorder</a></span><span class="op">(</span><span class="va">vartestDT</span>, <span class="va">var</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check arbitrary index values</span></span>
<span><span class="va">testDT</span><span class="op">[</span><span class="va">i</span> <span class="op">==</span> <span class="st">'812'</span> <span class="op">&amp;</span> <span class="va">j</span> <span class="op">==</span> <span class="st">'2'</span><span class="op">]</span></span>
<span><span class="va">testDT</span><span class="op">[</span><span class="va">i</span> <span class="op">==</span> <span class="st">'667'</span> <span class="op">&amp;</span> <span class="va">j</span> <span class="op">==</span> <span class="st">'1072'</span><span class="op">]</span></span>
<span><span class="va">testDT</span><span class="op">[</span><span class="va">i</span> <span class="op">==</span> <span class="st">'667'</span> <span class="op">&amp;</span> <span class="va">j</span> <span class="op">==</span> <span class="st">'2880'</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># plot difference in values</span></span>
<span><span class="va">pl</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">=</span> <span class="va">pl</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vartestDT</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">=</span> <span class="va">pl</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">=</span> <span class="va">pl</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'difference nanostring - Giotto'</span><span class="op">)</span></span>
<span><span class="va">pl</span></span>
<span></span>
<span><span class="va">testDT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#      i j x method combo</span></span>
<span><span class="co"># 1: 812 2 1 giotto 812-2</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#      i    j  x     method    combo</span></span>
<span><span class="co"># 1: 667 1072 50     giotto 667-1072</span></span>
<span><span class="co"># 2: 667 1072 56 nanostring 667-1072</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#      i    j  x     method    combo</span></span>
<span><span class="co"># 1: 667 2880 24     giotto 667-2880</span></span>
<span><span class="co"># 2: 667 2880 15 nanostring 667-2880</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/values_diff.png"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">testDT</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="st">'method'</span><span class="op">]</span></span>
<span></span>
<span><span class="va">testDT</span><span class="op">[</span>, <span class="va">method</span>, by <span class="op">=</span> <span class="va">combo</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">combo</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#        method      N</span></span>
<span><span class="co"># 1:     giotto 415952</span></span>
<span><span class="co"># 2: nanostring 416099</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># 411050</span></span></code></pre></div>
<p>Overall, the nanostring matrix has <strong>416099 - 415952 =
147</strong> more non-zero values than giottoâ€™s matrix for FOV2. Within
the <strong>411050</strong> shared entries that were called by both
methods (common i and j indices), there appears to be no major bias in
terms of counts/values assigned. Moreover, the vast majority of these
shared entries have the same values (difference of 0).</p>
</div>
</div>
<div class="section level2">
<h2 id="filtering-and-normalization">7. Filtering and normalization<a class="anchor" aria-label="anchor" href="#filtering-and-normalization"></a>
</h2>
<p>After the expression matrix is generated from the subcellular
information, analysis proceeds through data filtering and
normalization.</p>
<p>For the normalization step, we will employ two types.</p>
<ul>
<li><p><strong>standard normalization method:</strong> <em>library size
normalization and log normalization.</em> This method will produce both
normalized and scaled values that are be returned as the â€˜normalizedâ€™
and â€™scaledâ€™expression matrices respectively. In this tutorial, the
normalized values will be used for generating expression statistics and
plotting expression values. The scaled values will be ignored. We will
also generate normalized values for the negative probes for
visualization purposes during which the library normalization step will
be skipped.</p></li>
<li><p><strong>pearson residuals:</strong> <em>A normalization that uses
the method described in</em> <a href="https://doi.org/10.1186/s13059-021-02451-7" class="external-link">Lause/Kobak et al,
2021</a>. This produces a set of values that are most similar in utility
to a scaled matrix and offer improvements to both HVF detection and PCA
generation. These values should not be used for statistics, plotting of
expression values, or differential expression analysis.</p></li>
</ul>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter (feat_type = 'rna' by default)</span></span>
<span><span class="va">fov_join</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterGiotto.html">filterGiotto</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                         feat_type <span class="op">=</span> <span class="st">'rna'</span>,</span>
<span>                         expression_threshold <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         feat_det_in_min_cells <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                         min_det_feats_per_cell <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># normalize</span></span>
<span><span class="co"># standard method of normalization (log normalization based)</span></span>
<span><span class="va">fov_join</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalizeGiotto.html">normalizeGiotto</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                            feat_type <span class="op">=</span> <span class="st">'rna'</span>,</span>
<span>                            norm_methods <span class="op">=</span> <span class="st">'standard'</span>,</span>
<span>                            verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">fov_join</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalizeGiotto.html">normalizeGiotto</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                            feat_type <span class="op">=</span> <span class="st">'neg_probe'</span>,</span>
<span>                            norm_methods <span class="op">=</span> <span class="st">'standard'</span>,</span>
<span>                            library_size_norm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># new normalization method based on pearson correlations (Lause/Kobak et al. 2021)</span></span>
<span><span class="co"># this normalized matrix is given the name 'pearson' using the update_slot param</span></span>
<span><span class="va">fov_join</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalizeGiotto.html">normalizeGiotto</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                            feat_type <span class="op">=</span> <span class="st">'rna'</span>,</span>
<span>                            scalefactor <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                            verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            norm_methods <span class="op">=</span> <span class="st">'pearson_resid'</span>,</span>
<span>                            update_slot <span class="op">=</span> <span class="st">'pearson'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/showGiottoExpression.html">showGiottoExpression</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># â””â”€â”€Spatial unit "cell"</span></span>
<span><span class="co">#    â”œâ”€â”€Feature type "rna"</span></span>
<span><span class="co">#    â”‚  â”œâ”€â”€Expression data "raw" values:</span></span>
<span><span class="co">#    â”‚  â”‚     An object of class exprObj </span></span>
<span><span class="co">#    â”‚  â”‚     for spatial unit: "cell" and feature type: "rna" </span></span>
<span><span class="co">#    â”‚  â”‚       Provenance:  cell </span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚     contains:</span></span>
<span><span class="co">#    â”‚  â”‚     960 x 8049 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#    â”‚  â”‚                                           </span></span>
<span><span class="co">#    â”‚  â”‚     LY6D  . . 1 . . . . . . . . . . ......</span></span>
<span><span class="co">#    â”‚  â”‚     IGHA1 . . . . . . . 2 . 1 . . . ......</span></span>
<span><span class="co">#    â”‚  â”‚     VWF   . . . 1 . . . . . 1 . . . ......</span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚      ........suppressing 8036 columns and 954 rows </span></span>
<span><span class="co">#    â”‚  â”‚                                            </span></span>
<span><span class="co">#    â”‚  â”‚     CLEC2D 1 . . . . . . . . 1 . . . ......</span></span>
<span><span class="co">#    â”‚  â”‚     MARCO  . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#    â”‚  â”‚     AATK   . . . . . . . . . . . . 2 ......</span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚      First four colnames:</span></span>
<span><span class="co">#    â”‚  â”‚      fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#    â”‚  â”‚      fov002-cell_3 fov002-cell_4 </span></span>
<span><span class="co">#    â”‚  â”‚  </span></span>
<span><span class="co">#    â”‚  â”œâ”€â”€Expression data "normalized" values:</span></span>
<span><span class="co">#    â”‚  â”‚     An object of class exprObj </span></span>
<span><span class="co">#    â”‚  â”‚     for spatial unit: "cell" and feature type: "rna" </span></span>
<span><span class="co">#    â”‚  â”‚       Provenance:  cell </span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚     contains:</span></span>
<span><span class="co">#    â”‚  â”‚     960 x 8049 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#    â”‚  â”‚                                                                      </span></span>
<span><span class="co">#    â”‚  â”‚     LY6D  . . 4.666202 .        . . . .        . .       . . . ......</span></span>
<span><span class="co">#    â”‚  â”‚     IGHA1 . . .        .        . . . 5.666544 . 4.70044 . . . ......</span></span>
<span><span class="co">#    â”‚  â”‚     VWF   . . .        4.940306 . . . .        . 4.70044 . . . ......</span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚      ........suppressing 8036 columns and 954 rows </span></span>
<span><span class="co">#    â”‚  â”‚                                                                </span></span>
<span><span class="co">#    â”‚  â”‚     CLEC2D 4.146744 . . . . . . . . 4.70044 . . .        ......</span></span>
<span><span class="co">#    â”‚  â”‚     MARCO  .        . . . . . . . . .       . . .        ......</span></span>
<span><span class="co">#    â”‚  â”‚     AATK   .        . . . . . . . . .       . . 5.909612 ......</span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚      First four colnames:</span></span>
<span><span class="co">#    â”‚  â”‚      fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#    â”‚  â”‚      fov002-cell_3 fov002-cell_4 </span></span>
<span><span class="co">#    â”‚  â”‚  </span></span>
<span><span class="co">#    â”‚  â”œâ”€â”€Expression data "scaled" values:</span></span>
<span><span class="co">#    â”‚  â”‚     An object of class exprObj </span></span>
<span><span class="co">#    â”‚  â”‚     for spatial unit: "cell" and feature type: "rna"</span></span>
<span><span class="co">#    â”‚  â”‚       Provenance: cell</span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚     contains:</span></span>
<span><span class="co">#    â”‚  â”‚     960 x 8049 dense matrix of class "dgeMatrix"</span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚                 [,1]        [,2]       [,3]       [,4]</span></span>
<span><span class="co">#    â”‚  â”‚     LY6D  -0.4392934 -0.07558225  2.8787372 -0.3035845</span></span>
<span><span class="co">#    â”‚  â”‚     IGHA1 -0.7570656 -0.51785331 -0.6631650 -0.6198371</span></span>
<span><span class="co">#    â”‚  â”‚     VWF   -0.4387262 -0.07479291 -0.3300452  2.8316967</span></span>
<span><span class="co">#    â”‚  â”‚     BECN1 -0.4359960 -0.07099306 -0.3271882 -0.3003029</span></span>
<span><span class="co">#    â”‚  â”‚     </span></span>
<span><span class="co">#    â”‚  â”‚      First four colnames:</span></span>
<span><span class="co">#    â”‚  â”‚      fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#    â”‚  â”‚      fov002-cell_3 fov002-cell_4 </span></span>
<span><span class="co">#    â”‚  â”‚  </span></span>
<span><span class="co">#    â”‚  â””â”€â”€Expression data "pearson" values:</span></span>
<span><span class="co">#    â”‚        An object of class exprObj </span></span>
<span><span class="co">#    â”‚        for spatial unit: "cell" and feature type: "rna"</span></span>
<span><span class="co">#    â”‚          Provenance: cell</span></span>
<span><span class="co">#    â”‚        </span></span>
<span><span class="co">#    â”‚        contains:</span></span>
<span><span class="co">#    â”‚        960 x 8049 dense matrix of class "dgeMatrix"</span></span>
<span><span class="co">#    â”‚        </span></span>
<span><span class="co">#    â”‚                    [,1]       [,2]       [,3]       [,4]</span></span>
<span><span class="co">#    â”‚        LY6D  -0.4031565 -0.1363425  2.6585234 -0.3025217</span></span>
<span><span class="co">#    â”‚        IGHA1 -1.4462051 -0.4933275 -1.2011147 -1.0898172</span></span>
<span><span class="co">#    â”‚        VWF   -0.4178857 -0.1413313 -0.3460168  2.8722347</span></span>
<span><span class="co">#    â”‚        BECN1 -0.4074196 -0.1377863 -0.3373461 -0.3057230</span></span>
<span><span class="co">#    â”‚        </span></span>
<span><span class="co">#    â”‚         First four colnames:</span></span>
<span><span class="co">#    â”‚         fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#    â”‚         fov002-cell_3 fov002-cell_4 </span></span>
<span><span class="co">#    â”‚     </span></span>
<span><span class="co">#    â””â”€â”€Feature type "neg_probe"</span></span>
<span><span class="co">#       â”œâ”€â”€Expression data "raw" values:</span></span>
<span><span class="co">#       â”‚     An object of class exprObj </span></span>
<span><span class="co">#       â”‚     for spatial unit: "cell" and feature type: "neg_probe" </span></span>
<span><span class="co">#       â”‚       Provenance:  cell </span></span>
<span><span class="co">#       â”‚     </span></span>
<span><span class="co">#       â”‚     contains:</span></span>
<span><span class="co">#       â”‚     20 x 8049 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#       â”‚                                              </span></span>
<span><span class="co">#       â”‚     NegPrb8  . . . . . . . . . . 2 . . ......</span></span>
<span><span class="co">#       â”‚     NegPrb10 1 . . . . . . . . . . . 1 ......</span></span>
<span><span class="co">#       â”‚     NegPrb20 . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#       â”‚     </span></span>
<span><span class="co">#       â”‚      ........suppressing 8036 columns and 14 rows </span></span>
<span><span class="co">#       â”‚                                              </span></span>
<span><span class="co">#       â”‚     NegPrb18 . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#       â”‚     NegPrb12 . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#       â”‚     NegPrb15 1 . 1 . . . . . . . . . . ......</span></span>
<span><span class="co">#       â”‚     </span></span>
<span><span class="co">#       â”‚      First four colnames:</span></span>
<span><span class="co">#       â”‚      fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#       â”‚      fov002-cell_3 fov002-cell_4 </span></span>
<span><span class="co">#       â”‚  </span></span>
<span><span class="co">#       â”œâ”€â”€Expression data "normalized" values:</span></span>
<span><span class="co">#       â”‚     An object of class exprObj </span></span>
<span><span class="co">#       â”‚     for spatial unit: "cell" and feature type: "neg_probe" </span></span>
<span><span class="co">#       â”‚       Provenance:  cell </span></span>
<span><span class="co">#       â”‚     </span></span>
<span><span class="co">#       â”‚     contains:</span></span>
<span><span class="co">#       â”‚     20 x 8049 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#       â”‚                                                     </span></span>
<span><span class="co">#       â”‚     NegPrb8  . . . . . . . . . . 1.584963 . . ......</span></span>
<span><span class="co">#       â”‚     NegPrb10 1 . . . . . . . . . .        . 1 ......</span></span>
<span><span class="co">#       â”‚     NegPrb20 . . . . . . . . . . .        . . ......</span></span>
<span><span class="co">#       â”‚     </span></span>
<span><span class="co">#       â”‚      ........suppressing 8036 columns and 14 rows </span></span>
<span><span class="co">#       â”‚                                              </span></span>
<span><span class="co">#       â”‚     NegPrb18 . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#       â”‚     NegPrb12 . . . . . . . . . . . . . ......</span></span>
<span><span class="co">#       â”‚     NegPrb15 1 . 1 . . . . . . . . . . ......</span></span>
<span><span class="co">#       â”‚     </span></span>
<span><span class="co">#       â”‚      First four colnames:</span></span>
<span><span class="co">#       â”‚      fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#       â”‚      fov002-cell_3 fov002-cell_4 </span></span>
<span><span class="co">#       â”‚  </span></span>
<span><span class="co">#       â””â”€â”€Expression data "scaled" values:</span></span>
<span><span class="co">#             An object of class exprObj </span></span>
<span><span class="co">#             for spatial unit: "cell" and feature type: "neg_probe"</span></span>
<span><span class="co">#               Provenance: cell</span></span>
<span><span class="co">#             </span></span>
<span><span class="co">#             contains:</span></span>
<span><span class="co">#             20 x 8049 dense matrix of class "dgeMatrix"</span></span>
<span><span class="co">#             </span></span>
<span><span class="co">#                            [,1]        [,2]       [,3]        [,4]</span></span>
<span><span class="co">#             NegPrb8  -0.3207888  0.03413209 -0.4045849  0.03413209</span></span>
<span><span class="co">#             NegPrb10  2.7851943  0.69791153 -0.3914547  0.69791153</span></span>
<span><span class="co">#             NegPrb20 -0.3685845 -2.11549922 -0.4471068 -2.11549922</span></span>
<span><span class="co">#             NegPrb21 -0.3472432 -1.15566687 -0.4281203 -1.15566687</span></span>
<span><span class="co">#             </span></span>
<span><span class="co">#              First four colnames:</span></span>
<span><span class="co">#              fov002-cell_1 fov002-cell_2</span></span>
<span><span class="co">#              fov002-cell_3 fov002-cell_4 </span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add statistics based on log normalized values for features rna and negative probes</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="../reference/addStatistics.html">addStatistics</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                         expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>                         feat_type <span class="op">=</span> <span class="st">'rna'</span><span class="op">)</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="../reference/addStatistics.html">addStatistics</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                         expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>                         feat_type <span class="op">=</span> <span class="st">'neg_probe'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View cellular data (default is feat = 'rna')</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/showGiottoCellMetadata.html">showGiottoCellMetadata</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span>
<span><span class="co"># View feature data</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/showGiottoFeatMetadata.html">showGiottoFeatMetadata</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># â””â”€â”€Spatial unit "cell"</span></span>
<span><span class="co">#    â”œâ”€â”€Feature type "rna"</span></span>
<span><span class="co">#    â”‚     An object of class cellMetaObj </span></span>
<span><span class="co">#    â”‚     Provenance: cell </span></span>
<span><span class="co">#    â”‚              cell_ID list_ID nr_feats perc_feats total_expr</span></span>
<span><span class="co">#    â”‚     1: fov002-cell_1  fov002      203  21.145833   925.1119</span></span>
<span><span class="co">#    â”‚     2: fov002-cell_2  fov002       31   3.229167   231.4284</span></span>
<span><span class="co">#    â”‚     3: fov002-cell_3  fov002      140  14.583333   712.4315</span></span>
<span><span class="co">#    â”‚     4: fov002-cell_4  fov002      124  12.916667   652.3757</span></span>
<span><span class="co">#    â”‚  </span></span>
<span><span class="co">#    â””â”€â”€Feature type "neg_probe"</span></span>
<span><span class="co">#          An object of class cellMetaObj </span></span>
<span><span class="co">#          Provenance: cell </span></span>
<span><span class="co">#                   cell_ID list_ID nr_feats perc_feats total_expr</span></span>
<span><span class="co">#          1: fov002-cell_1  fov002        2         10          2</span></span>
<span><span class="co">#          2: fov002-cell_2  fov002        0          0          0</span></span>
<span><span class="co">#          3: fov002-cell_3  fov002        3         15          3</span></span>
<span><span class="co">#          4: fov002-cell_4  fov002        0          0          0</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># â””â”€â”€Spatial unit "cell"</span></span>
<span><span class="co">#    â”œâ”€â”€Feature type "rna"</span></span>
<span><span class="co">#    â”‚     An object of class featMetaObj </span></span>
<span><span class="co">#    â”‚     Provenance: cell </span></span>
<span><span class="co">#    â”‚        feat_ID nr_cells perc_cells total_expr mean_expr mean_expr_det</span></span>
<span><span class="co">#    â”‚     1:    LY6D      922   11.45484   3933.493 0.4886934      4.266262</span></span>
<span><span class="co">#    â”‚     2:   IGHA1     2900   36.02932  15960.468 1.9829131      5.503610</span></span>
<span><span class="co">#    â”‚     3:     VWF      919   11.41757   4047.916 0.5029092      4.404696</span></span>
<span><span class="co">#    â”‚     4:   BECN1      903   11.21878   3828.386 0.4756350      4.239630</span></span>
<span><span class="co">#    â”‚  </span></span>
<span><span class="co">#    â””â”€â”€Feature type "neg_probe"</span></span>
<span><span class="co">#          An object of class featMetaObj </span></span>
<span><span class="co">#          Provenance: cell </span></span>
<span><span class="co">#              feat_ID nr_cells perc_cells total_expr  mean_expr mean_expr_det</span></span>
<span><span class="co">#          1:  NegPrb8      642   7.976146   716.2937 0.08899164      1.115722</span></span>
<span><span class="co">#          2: NegPrb10      566   7.031929   611.7775 0.07600664      1.080879</span></span>
<span><span class="co">#          3: NegPrb20      888  11.032426  1003.0484 0.12461776      1.129559</span></span>
<span><span class="co">#          4: NegPrb21      771   9.578830   849.4211 0.10553125      1.101713</span></span></code></pre></div>
<p><strong>Note:</strong> The show functions for metadata do not return
the information. To retrieve the metadata information, instead use
<code><a href="https://drieslab.github.io/GiottoClass/reference/pDataDT.html">pDataDT()</a></code> and <code><a href="https://drieslab.github.io/GiottoClass/reference/fDataDT.html">fDataDT()</a></code> along with the
<code>feat_type</code> param for either â€˜rnaâ€™ or â€˜neg_probeâ€™.</p>
</div>
<div class="section level2">
<h2 id="view-transcript-total-expression-distribution">8. View Transcript Total Expression Distribution<a class="anchor" aria-label="anchor" href="#view-transcript-total-expression-distribution"></a>
</h2>
<div class="section level3">
<h3 id="histogram-of-log-normalized-data">8.1 Histogram of log normalized data<a class="anchor" aria-label="anchor" href="#histogram-of-log-normalized-data"></a>
</h3>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/filterDistributions.html">filterDistributions</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                    detection <span class="op">=</span> <span class="st">'cells'</span>,</span>
<span>                    feat_type <span class="op">=</span> <span class="st">'rna'</span>,</span>
<span>                    expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">'sum'</span>,</span>
<span>                    nr_bins <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                    save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                      save_name <span class="op">=</span> <span class="st">'5.1_rna_norm_total_hist'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/filterDistributions.html">filterDistributions</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                    detection <span class="op">=</span> <span class="st">'cell'</span>,</span>
<span>                    feat_type <span class="op">=</span> <span class="st">'neg_probe'</span>,</span>
<span>                    expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">'sum'</span>,</span>
<span>                    nr_bins <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                    save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                      save_name <span class="op">=</span> <span class="st">'5.2_neg_norm_total_hist'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>RNA</strong></p>
<p><img src="images/nanostring_cosmx_lung_cancer/5.1_rna_norm_total_hist.png"></p>
<p><strong>Negative Probe</strong></p>
<p><img src="images/nanostring_cosmx_lung_cancer/5.2_neg_norm_total_hist.png"></p>
</div>
<div class="section level3">
<h3 id="plot-spatially-as-centroids">8.2 Plot spatially as centroids<a class="anchor" aria-label="anchor" href="#plot-spatially-as-centroids"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatPlot.html">spatPlot2D</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>           cell_color <span class="op">=</span> <span class="st">'total_expr'</span>,</span>
<span>           color_as_factor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>           show_image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           image_name <span class="op">=</span> <span class="va">image_names</span>,</span>
<span>           point_size <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>           point_alpha <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>           save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                             save_name <span class="op">=</span> <span class="st">'5.3_color_centroids'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/5.3_color_centroids.png"></p>
</div>
<div class="section level3">
<h3 id="plot-spatially-as-color-scaled-polygons">8.3 Plot spatially as color-scaled polygons<a class="anchor" aria-label="anchor" href="#plot-spatially-as-color-scaled-polygons"></a>
</h3>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_color <span class="op">=</span> <span class="st">'gray'</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                     polygon_fill <span class="op">=</span> <span class="st">'total_expr'</span>,</span>
<span>                     polygon_fill_as_factor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                       save_name <span class="op">=</span> <span class="st">'5.4_rna_color_polys'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                     feat_type <span class="op">=</span> <span class="st">'neg_probe'</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_color <span class="op">=</span> <span class="st">'gray'</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                     polygon_fill <span class="op">=</span> <span class="st">'total_expr'</span>,</span>
<span>                     polygon_fill_as_factor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                       save_name <span class="op">=</span> <span class="st">'5.5_neg_color_polys'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>RNA</strong></p>
<p><img src="images/nanostring_cosmx_lung_cancer/5.4_rna_color_polys.png"></p>
<p><strong>Negative Probe</strong></p>
<p><img src="images/nanostring_cosmx_lung_cancer/5.5_neg_color_polys.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="dimension-reduction">9. Dimension Reduction<a class="anchor" aria-label="anchor" href="#dimension-reduction"></a>
</h2>
<div class="section level3">
<h3 id="detect-highly-variable-genes-and-generate-pca">9.1 Detect highly variable genes and generate PCA<a class="anchor" aria-label="anchor" href="#detect-highly-variable-genes-and-generate-pca"></a>
</h3>
<p>Detect highly variable genes using the pearson residuals method based
on the â€˜pearsonâ€™ expression matrix. These results will be returned as a
new â€˜hvfâ€™ column in the â€˜rnaâ€™ feature metadata.</p>
<p>PCA generation will also be based on the â€˜pearsonâ€™ matrix. Scaling
and centering of the PCA which is usually done by default will be
skipped since the pearson matrix is already scaled.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculateHVF.html">calculateHVF</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">'var_p_resid'</span>,</span>
<span>                        expression_values <span class="op">=</span> <span class="st">'pearson'</span>,</span>
<span>                        save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                          save_name <span class="op">=</span> <span class="st">'6.1_pearson_HVF'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print HVFs</span></span>
<span><span class="va">gene_meta</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/fDataDT.html">fDataDT</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span>
<span><span class="va">gene_meta</span><span class="op">[</span><span class="va">hvf</span> <span class="op">==</span> <span class="st">'yes'</span>, <span class="va">feat_ID</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#   [1] "IGHA1"    "S100A4"   "NEAT1"    "MYH11"    "BMP6"    </span></span>
<span><span class="co">#   [6] "LGALS3"   "CLU"      "LTB"      "HLA-DQB1" "GDF15"   </span></span>
<span><span class="co">#  [11] "ENTPD1"   "CCL21"    "IL17A"    "GDNF"     "COL5A1"  </span></span>
<span><span class="co">#  [16] "HLA-B"    "IGKC"     "COL4A2"   "MZT2A"    "SERPINA1"</span></span>
<span><span class="co">#  [21] "THBS1"    "MGP"      "IL32"     "HLA-DPA1" "RGS1"    </span></span>
<span><span class="co">#  [26] "IGFBP3"   "FCRLA"    "CXCL1"    "TYK2"     "KLF2"    </span></span>
<span><span class="co">#  [31] "HSPB1"    "ITGB6"    "COL6A1"   "WIF1"     "ANXA2"   </span></span>
<span><span class="co">#  [36] "THBS2"    "DUSP5"    "CXCL8"    "COL6A2"   "FGF2"    </span></span>
<span><span class="co">#  [41] "HSPA1A"   "TIMP1"    "TPM2"     "CD163"    "NPPC"    </span></span>
<span><span class="co">#  [46] "KRT8"     "IGHG1"    "CD68"     "SAA1"     "KRT7"    </span></span>
<span><span class="co">#  [51] "IGHM"     "IL1RN"    "B2M"      "LUM"      "FKBP11"  </span></span>
<span><span class="co">#  [56] "COL1A1"   "COL5A2"   "CX3CR1"   "MAF"      "TAGLN"   </span></span>
<span><span class="co">#  [61] "IL23A"    "BGN"      "FN1"      "DCN"      "CXCL10"  </span></span>
<span><span class="co">#  [66] "CD74"     "RARRES1"  "MALAT1"   "LTF"      "HLA-DRB5"</span></span>
<span><span class="co">#  [71] "CALD1"    "C11orf96" "ADGRE2"   "MT1X"     "IGFBP5"  </span></span>
<span><span class="co">#  [76] "IGHG2"    "LCN2"     "TEK"      "PIGR"     "DUSP1"   </span></span>
<span><span class="co">#  [81] "IGFBP7"   "TM4SF1"   "DUSP2"    "CEACAM6"  "VIM"     </span></span>
<span><span class="co">#  [86] "FOS"      "COL9A2"   "CCL19"    "OLFM4"    "HLA-DPB1"</span></span>
<span><span class="co">#  [91] "CXCL14"   "NFKBIA"   "HLA-DQA1" "CD14"     "HLA-C"   </span></span>
<span><span class="co">#  [96] "DLL1"     "KRT17"    "LDLR"     "CCL2"     "GLUL"    </span></span>
<span><span class="co"># [101] "TPSAB1"   "COL3A1"   "C1QA"     "S100A8"   "GSN"     </span></span>
<span><span class="co"># [106] "HSPA1B"   "MMP12"    "COL18A1"  "CIITA"    "HLA-DRB1"</span></span>
<span><span class="co"># [111] "PSAP"     "SOD2"     "S100A2"   "LGALS1"   "STAT4"   </span></span>
<span><span class="co"># [116] "GADD45B"  "KDR"      "MMP14"    "KRT19"    "IL17D"   </span></span>
<span><span class="co"># [121] "MT2A"     "CXCR6"    "IL1B"     "FCGBP"    "CCL3L3"  </span></span>
<span><span class="co"># [126] "SPP1"     "CCL3"     "S100A6"   "IL16"     "ITGB4"   </span></span>
<span><span class="co"># [131] "RGCC"     "COL6A3"   "COL1A2"   "C1QC"     "CD8A"    </span></span>
<span><span class="co"># [136] "GZMK"     "TCL1A"    "IGF2"     "JCHAIN"   "SPARCL1" </span></span>
<span><span class="co"># [141] "NDRG1"    "PSCA"     "CXCL3"    "HLA-DRA"  "CD79A"   </span></span>
<span><span class="co"># [146] "MEG3"     "SRGN"     "COL4A1"   "TNFRSF19" "ICAM1"   </span></span>
<span><span class="co"># [151] "RGS2"     "LYZ"      "CD83"     "CCL4L2"   "CD69"    </span></span>
<span><span class="co"># [156] "ACTA2"    "KRT5"     "MMP10"    "MMP2"     "CXCR5"   </span></span>
<span><span class="co"># [161] "CPA3"     "TPSB2"    "C1QB"     "CXCL2"    "CXCL5"   </span></span>
<span><span class="co"># [166] "AGR2"     "PDCD1"    "BCL2"     "XBP1"     "PDGFRB" </span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/6.1_pearson_HVF.png"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="../reference/runPCA.html">runPCA</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                  scale_unit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  center <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  expression_values <span class="op">=</span> <span class="st">'pearson'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># screeplot uses the generated PCA. No need to specify expr values</span></span>
<span><span class="fu"><a href="../reference/screePlot.html">screePlot</a></span><span class="op">(</span><span class="va">fov_join</span>, ncp <span class="op">=</span> <span class="fl">20</span>, save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'6.2_screeplot'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/plotPCA.html">plotPCA</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>        cell_color <span class="op">=</span> <span class="st">'nr_feats'</span>, <span class="co"># (from log norm statistics)</span></span>
<span>        color_as_factor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        point_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>        point_shape <span class="op">=</span> <span class="st">'no_border'</span>,</span>
<span>        save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'6.3_PCA'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/6.2_screeplot.png"><img src="images/nanostring_cosmx_lung_cancer/6.3_PCA.png"></p>
</div>
<div class="section level3">
<h3 id="run-umap">9.2 Run UMAP<a class="anchor" aria-label="anchor" href="#run-umap"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate UMAP from PCA</span></span>
<span><span class="va">fov_join</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runUMAP.html">runUMAP</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                    dimensions_to_use <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                    n_threads <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/plotUMAP.html">plotUMAP</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>, save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'6.4_UMAP'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/6.4_UMAP.png"></p>
</div>
<div class="section level3">
<h3 id="plot-features-on-expression-space">9.3 Plot features on expression space<a class="anchor" aria-label="anchor" href="#plot-features-on-expression-space"></a>
</h3>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/dimFeatPlot2D.html">dimFeatPlot2D</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>              feat_type <span class="op">=</span> <span class="st">'rna'</span>,</span>
<span>              feats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'MKI67'</span>, <span class="st">'CD8A'</span>, <span class="st">'CD4'</span>,</span>
<span>                        <span class="st">'COL1A1'</span>, <span class="st">'MS4A1'</span>, <span class="st">'MZB1'</span><span class="op">)</span>,</span>
<span>              expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>              point_shape <span class="op">=</span> <span class="st">'no_border'</span>,</span>
<span>              point_size <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>              cow_n_col <span class="op">=</span> <span class="fl">3</span>,</span>
<span>              save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                save_name <span class="op">=</span> <span class="st">'6.5_UMAP_feats'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/6.5_UMAP_feats.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="cluster">10. Cluster<a class="anchor" aria-label="anchor" href="#cluster"></a>
</h2>
<div class="section level3">
<h3 id="visualize-clustering">10.1 Visualize clustering<a class="anchor" aria-label="anchor" href="#visualize-clustering"></a>
</h3>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fov_join</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/createNearestNetwork.html">createNearestNetwork</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                                 dimensions_to_use <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                                 k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fov_join</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/doLeidenCluster.html">doLeidenCluster</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                            resolution <span class="op">=</span> <span class="fl">0.07</span>,</span>
<span>                            n_iterations <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize UMAP cluster results</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/plotUMAP.html">plotUMAP</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>         cell_color <span class="op">=</span> <span class="st">'leiden_clus'</span>,</span>
<span>         cell_color_code <span class="op">=</span> <span class="va">pal10</span>,</span>
<span>         show_NN_network <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         point_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'7.1_UMAP_leiden'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/7.1_UMAP_leiden.png"></p>
</div>
<div class="section level3">
<h3 id="visualize-clustering-on-expression-and-spatial-space">10.2 Visualize clustering on expression and spatial space<a class="anchor" aria-label="anchor" href="#visualize-clustering-on-expression-and-spatial-space"></a>
</h3>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualize UMAP and spatial results</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatDimPlot.html">spatDimPlot2D</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>              show_image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              image_name <span class="op">=</span> <span class="va">image_names</span>,</span>
<span>              cell_color <span class="op">=</span> <span class="st">'leiden_clus'</span>,</span>
<span>              cell_color_code <span class="op">=</span> <span class="va">pal10</span>,</span>
<span>              spat_point_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'7.2_spatdim_leiden'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/7.2_spatdim_leiden.png"></p>
</div>
<div class="section level3">
<h3 id="map-clustering-spatially">10.3 Map clustering spatially<a class="anchor" aria-label="anchor" href="#map-clustering-spatially"></a>
</h3>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                     feats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'rna'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'MMP2'</span>, <span class="st">'VEGFA'</span>, <span class="st">'IGF1R'</span>,</span>
<span>                                            <span class="st">'MKI67'</span>, <span class="st">'EPCAM'</span>, <span class="st">'MZB1'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     point_size <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>                     feats_color_code <span class="op">=</span> <span class="va">viv10</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_color <span class="op">=</span> <span class="st">'white'</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                     polygon_fill <span class="op">=</span> <span class="st">'leiden_clus'</span>,</span>
<span>                     polygon_fill_as_factor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_fill_code <span class="op">=</span> <span class="va">pal10</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                       save_name <span class="op">=</span> <span class="st">'7.3_spatinsitu_leiden'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/7.3_spatinsitu_leiden.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="small-subset-visualization">11. Small Subset Visualization<a class="anchor" aria-label="anchor" href="#small-subset-visualization"></a>
</h2>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subset a Giotto object based on spatial locations</span></span>
<span><span class="va">smallfov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/subsetGiottoLocs.html">subsetGiottoLocs</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                             x_max <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>                             x_min <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                             y_max <span class="op">=</span> <span class="op">-</span><span class="fl">157800</span>,</span>
<span>                             y_min <span class="op">=</span> <span class="op">-</span><span class="fl">159800</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#extract all genes observed in new object</span></span>
<span><span class="va">smallfeats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/fDataDT.html">fDataDT</a></span><span class="op">(</span><span class="va">smallfov</span><span class="op">)</span><span class="op">[</span>, <span class="va">feat_ID</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#plot all genes</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">smallfov</span>,</span>
<span>                     feats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">smallfeats</span><span class="op">)</span>,</span>
<span>                     point_size <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_color <span class="op">=</span> <span class="st">'white'</span>,</span>
<span>                     show_image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     largeImage_name <span class="op">=</span> <span class="st">'fov002-composite'</span>,</span>
<span>                     show_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'8.1_smallfov_points'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot only the polygon outlines</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">smallfov</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                     polygon_alpha <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                     polygon_color <span class="op">=</span> <span class="st">'white'</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     show_image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     largeImage_name <span class="op">=</span> <span class="st">'fov002-composite'</span>,</span>
<span>                     show_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'8.2_smallfov_poly'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot polygons colorlabeled with leiden clusters</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">smallfov</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_fill <span class="op">=</span> <span class="st">'leiden_clus'</span>,</span>
<span>                     polygon_fill_as_factor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_fill_code <span class="op">=</span> <span class="va">pal10</span>,</span>
<span>                     show_image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     largeImage_name <span class="op">=</span> <span class="st">'fov002-composite'</span>,</span>
<span>                     show_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'8.3_smallfov_leiden'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/8.1_smallfov_points.png"><img src="images/nanostring_cosmx_lung_cancer/8.2_smallfov_poly.png"><img src="images/nanostring_cosmx_lung_cancer/8.3_smallfov_leiden.png"></p>
</div>
<div class="section level2">
<h2 id="spatial-expression-patterns">12. Spatial Expression Patterns<a class="anchor" aria-label="anchor" href="#spatial-expression-patterns"></a>
</h2>
<p>Find spatially organized gene expression by examining the binarized
expression of cells and their spatial neighbors.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create spatial network based on physical distance of cell centroids</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/createSpatialNetwork.html">createSpatialNetwork</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                                minimum_k <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                maximum_distance_delaunay <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># perform Binary Spatial Extraction of genes - NOTE: Depending on your system this could take time</span></span>
<span><span class="va">km_spatialgenes</span> <span class="op">=</span> <span class="fu"><a href="../reference/binSpect.html">binSpect</a></span><span class="op">(</span><span class="va">fov_join</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize spatial expression of selected genes obtained from binSpect</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatFeatPlot2D.html">spatFeatPlot2D</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>               expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>               feats <span class="op">=</span> <span class="va">km_spatialgenes</span><span class="op">$</span><span class="va">feats</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>               point_shape <span class="op">=</span> <span class="st">'no_border'</span>,</span>
<span>               point_border_stroke <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>               point_size <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>               cow_n_col <span class="op">=</span> <span class="fl">2</span>,</span>
<span>               save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'9_binspect_genes'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/9_binspect_genes.png"></p>
</div>
<div class="section level2">
<h2 id="identify-cluster-differential-expression-genes">13. Identify cluster differential expression genes<a class="anchor" aria-label="anchor" href="#identify-cluster-differential-expression-genes"></a>
</h2>
<div class="section level3">
<h3 id="violin-plot">13.1 Violin plot<a class="anchor" aria-label="anchor" href="#violin-plot"></a>
</h3>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Gini</span></span>
<span><span class="va">markers</span> <span class="op">=</span> <span class="fu"><a href="../reference/findMarkers_one_vs_all.html">findMarkers_one_vs_all</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                                 method <span class="op">=</span> <span class="st">'gini'</span>,</span>
<span>                                 expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>                                 cluster_column <span class="op">=</span> <span class="st">'leiden_clus'</span>,</span>
<span>                                 min_feats <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                 rank_score <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># First 5 results by cluster</span></span>
<span><span class="va">markers</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="fl">5</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">'cluster'</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># violinplot</span></span>
<span><span class="va">topgini_genes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">markers</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="fl">2</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">'cluster'</span><span class="op">]</span><span class="op">$</span><span class="va">feats</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/violinPlot.html">violinPlot</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>           feats <span class="op">=</span> <span class="va">topgini_genes</span>,</span>
<span>           cluster_column <span class="op">=</span> <span class="st">'leiden_clus'</span>,</span>
<span>           strip_position <span class="op">=</span> <span class="st">'right'</span>,</span>
<span>           save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'10.1_gini_violin'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#     cluster    feats expression expression_gini  detection detection_gini expression_rank detection_rank   comb_score comb_rank</span></span>
<span><span class="co">#  1:       1  CEACAM6  0.3005461      0.32848944 0.06234867     0.32595794             0.1           0.55 5.889056e-03         1</span></span>
<span><span class="co">#  2:       1     TYK2  4.3646431      0.08881957 0.67493947     0.07004094             0.1           0.55 3.421554e-04       457</span></span>
<span><span class="co">#  3:       1    RAMP1  2.8381932      0.04598805 0.50665860     0.07329526             0.1           0.55 1.853888e-04       696</span></span>
<span><span class="co">#  4:       1   COL9A2  3.3775202      0.02803581 0.58353511     0.05483438             0.1           0.55 8.455294e-05       857</span></span>
<span><span class="co">#  5:       1     WIF1  3.6318024      0.02295722 0.62046005     0.04942676             0.1           0.55 6.240854e-05       885</span></span>
<span><span class="co">#  6:       2  CEACAM6  3.5574984      0.40305510 0.69286658     0.38975970             1.0           1.00 1.570946e-01         1</span></span>
<span><span class="co">#  7:       2     AGR2  2.8990604      0.39072866 0.60237781     0.38035439             1.0           1.00 1.486154e-01         2</span></span>
<span><span class="co">#  8:       2     PSCA  2.7500933      0.37081552 0.54821664     0.35942508             1.0           1.00 1.332804e-01         3</span></span>
<span><span class="co">#  9:       2   TM4SF1  4.2980932      0.34496868 0.80581242     0.33059895             1.0           1.00 1.140463e-01         4</span></span>
<span><span class="co"># 10:       2    ITGB4  2.9779267      0.31322641 0.64266843     0.31854817             1.0           1.00 9.977770e-02         5</span></span>
<span><span class="co"># 11:       3   COL1A2  5.1763307      0.35868057 0.84092940     0.32712715             1.0           1.00 1.173342e-01         1</span></span>
<span><span class="co"># 12:       3   COL3A1  4.6626627      0.35227376 0.79624665     0.32419688             1.0           1.00 1.142061e-01         2</span></span>
<span><span class="co"># 13:       3   COL5A1  2.8124393      0.30790277 0.54870420     0.29029496             1.0           1.00 8.938262e-02         6</span></span>
<span><span class="co"># 14:       3    CALD1  2.7964416      0.29034672 0.53976765     0.27132087             1.0           1.00 7.877712e-02         7</span></span>
<span><span class="co"># 15:       3   COL4A2  3.7519663      0.28290733 0.66041108     0.25489261             1.0           1.00 7.211099e-02         8</span></span>
<span><span class="co"># 16:       4   JCHAIN  2.3085145      0.31920894 0.38356164     0.27096015             1.0           1.00 8.649290e-02         1</span></span>
<span><span class="co"># 17:       4    IGHA1  6.0272393      0.29235201 0.77123288     0.20720352             1.0           1.00 6.057637e-02         2</span></span>
<span><span class="co"># 18:       4     IGKC  6.0069266      0.27710427 0.80821918     0.21309249             1.0           1.00 5.904884e-02         3</span></span>
<span><span class="co"># 19:       4    IGHG2  5.1049710      0.21301372 0.75753425     0.16159106             1.0           1.00 3.442111e-02         5</span></span>
<span><span class="co"># 20:       4    IGHG1  6.0348289      0.21398818 0.84109589     0.15579987             1.0           1.00 3.333933e-02         6</span></span>
<span><span class="co"># 21:       5  HLA-DRA  3.5278230      0.35261913 0.68000000     0.33461396             1.0           1.00 1.179913e-01         1</span></span>
<span><span class="co"># 22:       5 HLA-DRB1  5.8080578      0.31796037 0.94000000     0.28322219             1.0           1.00 9.005343e-02         4</span></span>
<span><span class="co"># 23:       5     C1QC  2.9167826      0.30428046 0.56153846     0.28012788             1.0           1.00 8.523744e-02         5</span></span>
<span><span class="co"># 24:       5 HLA-DQA1  3.4158034      0.29287085 0.66307692     0.27394289             1.0           1.00 8.022989e-02         7</span></span>
<span><span class="co"># 25:       5 HLA-DPA1  4.5054688      0.29433678 0.81076923     0.26644593             1.0           1.00 7.842484e-02         8</span></span>
<span><span class="co"># 26:       6     IGKC  7.7995871      0.30816788 0.91193182     0.22600725             1.0           1.00 6.964818e-02         1</span></span>
<span><span class="co"># 27:       6    IGHG2  8.9434075      0.31508193 1.00000000     0.21706726             1.0           1.00 6.839397e-02         3</span></span>
<span><span class="co"># 28:       6     XBP1  3.0542933      0.25791147 0.55681818     0.21972330             1.0           1.00 5.666916e-02         4</span></span>
<span><span class="co"># 29:       6    IGHG1  9.6683517      0.29921666 1.00000000     0.18784629             1.0           1.00 5.620674e-02         5</span></span>
<span><span class="co"># 30:       6    IGHA1  3.9283810      0.17471016 0.61931818     0.13994645             1.0           1.00 2.445007e-02         9</span></span>
<span><span class="co"># 31:       7   ADGRG1  2.3821747      0.34229952 0.62827225     0.35696837             1.0           1.00 1.221901e-01         1</span></span>
<span><span class="co"># 32:       7    EPHB6  2.6829243      0.33650319 0.68586387     0.34987822             1.0           1.00 1.177351e-01         2</span></span>
<span><span class="co"># 33:       7   SLC2A1  2.7642290      0.31840437 0.70680628     0.33418653             1.0           1.00 1.064065e-01         3</span></span>
<span><span class="co"># 34:       7   S100A2  5.2415295      0.33596555 0.92670157     0.31263296             1.0           1.00 1.050339e-01         4</span></span>
<span><span class="co"># 35:       7    ITGA3  4.2001159      0.32268560 0.91099476     0.31732234             1.0           1.00 1.023953e-01         5</span></span>
<span><span class="co"># 36:       8    CXCL8  3.8332176      0.34293929 0.62500000     0.30076350             1.0           1.00 1.031436e-01         1</span></span>
<span><span class="co"># 37:       8    CCL15  2.5480321      0.17891558 0.52500000     0.16468271             1.0           1.00 2.946430e-02        51</span></span>
<span><span class="co"># 38:       8    KRT18  2.5900116      0.11144915 0.54166667     0.10688863             1.0           1.00 1.191265e-02       225</span></span>
<span><span class="co"># 39:       8     RARA  3.0165397      0.10350445 0.61666667     0.09770431             1.0           1.00 1.011283e-02       269</span></span>
<span><span class="co"># 40:       8    RPL21  3.8977863      0.09196966 0.74166667     0.08031020             1.0           1.00 7.386102e-03       335</span></span>
<span><span class="co"># 41:       9  COL12A1  3.1357798      0.37144461 0.74000000     0.37663390             1.0           1.00 1.398986e-01         1</span></span>
<span><span class="co"># 42:       9   COL6A1  5.4311138      0.37885115 0.96000000     0.35502793             1.0           1.00 1.345027e-01         2</span></span>
<span><span class="co"># 43:       9   COL6A3  5.3010486      0.37021296 0.96000000     0.35369715             1.0           1.00 1.309433e-01         3</span></span>
<span><span class="co"># 44:       9      LUM  4.1146700      0.36697530 0.82000000     0.35593448             1.0           1.00 1.306192e-01         4</span></span>
<span><span class="co"># 45:       9   COL6A2  5.5736044      0.36936888 1.00000000     0.34879032             1.0           1.00 1.288323e-01         5</span></span>
<span><span class="co"># 46:      10   JCHAIN  6.9947297      0.41405696 1.00000000     0.38000000             1.0           1.00 1.573416e-01         1</span></span>
<span><span class="co"># 47:      10     IGHM  9.7929156      0.41818020 1.00000000     0.34508525             1.0           1.00 1.443078e-01         2</span></span>
<span><span class="co"># 48:      10     IGKC  7.5834742      0.28325352 0.89473684     0.20871211             1.0           1.00 5.911844e-02         4</span></span>
<span><span class="co"># 49:      10    IGHA1  4.4631436      0.19301447 0.73684211     0.17215134             1.0           1.00 3.322770e-02        18</span></span>
<span><span class="co"># 50:      10    IGHG1  5.1429134      0.15242469 0.84210526     0.13847022             1.0           1.00 2.110628e-02        40</span></span>
<span><span class="co">#     cluster    feats expression expression_gini  detection detection_gini expression_rank detection_rank   comb_score comb_rank</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/10.1_gini_violin.png"></p>
</div>
<div class="section level3">
<h3 id="heatmap">13.2 Heatmap<a class="anchor" aria-label="anchor" href="#heatmap"></a>
</h3>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_order</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/plotMetaDataHeatmap.html">plotMetaDataHeatmap</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                    expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>                    metadata_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'leiden_clus'</span><span class="op">)</span>,</span>
<span>                    selected_feats <span class="op">=</span> <span class="va">topgini_genes</span>,</span>
<span>                    custom_cluster_order <span class="op">=</span> <span class="va">cluster_order</span>,</span>
<span>                    save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                      save_name <span class="op">=</span> <span class="st">'10.2_heatmap'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/10.2_heatmap.png"></p>
</div>
<div class="section level3">
<h3 id="plot-gini-genes-on-umap">13.3 Plot gini genes on UMAP<a class="anchor" aria-label="anchor" href="#plot-gini-genes-on-umap"></a>
</h3>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># low, mid, high</span></span>
<span><span class="va">custom_scale</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#440154'</span>, <span class="st">'#1F968B'</span>, <span class="st">'#FDE725'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/dimFeatPlot2D.html">dimFeatPlot2D</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>              expression_values <span class="op">=</span> <span class="st">'normalized'</span>,</span>
<span>              cell_color_gradient <span class="op">=</span> <span class="va">custom_scale</span>,</span>
<span>              gradient_midpoint <span class="op">=</span> <span class="fl">5</span>,</span>
<span>              feats <span class="op">=</span> <span class="va">topgini_genes</span>,</span>
<span>              point_shape <span class="op">=</span> <span class="st">'no_border'</span>,</span>
<span>              point_size <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>              cow_n_col <span class="op">=</span> <span class="fl">4</span>,</span>
<span>              save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                save_name <span class="op">=</span> <span class="st">'10.3_gini_genes'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/10.3_gini_genes.png"></p>
</div>
<div class="section level3">
<h3 id="annotate-giotto-object">13.4 Annotate Giotto Object<a class="anchor" aria-label="anchor" href="#annotate-giotto-object"></a>
</h3>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## add cell types ###</span></span>
<span><span class="va">clusters_cell_types_lung</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Normal Epithelial 1'</span>, <span class="st">'Cancer'</span>, <span class="st">'Stromal'</span>, <span class="st">'B-lineage'</span>,</span>
<span>                             <span class="st">'Macrophage'</span>, <span class="st">'B-lineage'</span>, <span class="st">'Cancer'</span>,</span>
<span>                             <span class="st">'Normal Epithelial 2'</span>, <span class="st">'Stromal'</span>, <span class="st">'B-lineage'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clusters_cell_types_lung</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">fov_join</span> <span class="op">=</span> <span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/annotateGiotto.html">annotateGiotto</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                          annotation_vector <span class="op">=</span> <span class="va">clusters_cell_types_lung</span>,</span>
<span>                          cluster_column <span class="op">=</span> <span class="st">'leiden_clus'</span>,</span>
<span>                          name <span class="op">=</span> <span class="st">'cell_types'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/plotUMAP.html">plotUMAP</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>         cell_color <span class="op">=</span> <span class="st">'cell_types'</span>,</span>
<span>         cell_color_code <span class="op">=</span> <span class="va">viv10</span>,</span>
<span>         point_size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>         save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'11_anno_umap'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/11_anno_umap.png"></p>
</div>
<div class="section level3">
<h3 id="visualize">13.5 Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h3>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatDimPlot.html">spatDimPlot2D</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>              show_image <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              image_name <span class="op">=</span> <span class="va">image_names</span>,</span>
<span>              cell_color <span class="op">=</span> <span class="st">'cell_types'</span>,</span>
<span>              cell_color_code <span class="op">=</span> <span class="va">viv10</span>,</span>
<span>              spat_point_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>save_name <span class="op">=</span> <span class="st">'12_spatdim_type'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/12_spatdim_type.png"></p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_feat_type <span class="op">=</span> <span class="st">'cell'</span>,</span>
<span>                     polygon_color <span class="op">=</span> <span class="st">'grey'</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                     polygon_fill <span class="op">=</span> <span class="st">'cell_types'</span>,</span>
<span>                     polygon_fill_as_factor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_fill_code <span class="op">=</span> <span class="va">viv10</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                       save_name <span class="op">=</span> <span class="st">'13_insitu_type'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/13_insitu_type.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="interaction-changed-genes">14. Interaction Changed Genes<a class="anchor" aria-label="anchor" href="#interaction-changed-genes"></a>
</h2>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">'multisession'</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="co"># NOTE: Depending on your system this could take time</span></span>
<span></span>
<span><span class="va">icf</span> <span class="op">=</span> <span class="fu"><a href="../reference/findInteractionChangedFeats.html">findInteractionChangedFeats</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>                                  cluster_column <span class="op">=</span> <span class="st">'cell_types'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify top ten interaction changed features</span></span>
<span><span class="va">icf</span><span class="op">$</span><span class="va">ICFscores</span><span class="op">[</span><span class="va">type_int</span> <span class="op">==</span> <span class="st">'hetero'</span><span class="op">]</span><span class="op">$</span><span class="va">feats</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Skip first two genes since they are too highly expressed</span></span>
<span><span class="va">icf_plotfeats</span> <span class="op">=</span> <span class="va">icf</span><span class="op">$</span><span class="va">ICFscores</span><span class="op">[</span><span class="va">type_int</span> <span class="op">==</span> <span class="st">'hetero'</span><span class="op">]</span><span class="op">$</span><span class="va">feats</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Visualize ICF expression</span></span>
<span><span class="fu"><a href="https://drieslab.github.io/Giotto/reference/spatInSituPlotPoints.html">spatInSituPlotPoints</a></span><span class="op">(</span><span class="va">fov_join</span>,</span>
<span>                     feats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">icf_plotfeats</span><span class="op">)</span>,</span>
<span>                     point_size <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>                     show_polygon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_feat_type <span class="op">=</span> <span class="st">'cell'</span>,</span>
<span>                     polygon_color <span class="op">=</span> <span class="st">'gray'</span>,</span>
<span>                     polygon_line_size <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                     polygon_fill <span class="op">=</span> <span class="st">'cell_types'</span>,</span>
<span>                     polygon_fill_as_factor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     polygon_fill_code <span class="op">=</span> <span class="va">pal10</span>,</span>
<span>                     save_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>base_height <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                       save_name <span class="op">=</span> <span class="st">'14_ICF'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/nanostring_cosmx_lung_cancer/14_ICF.png"></p>
</div>
<div class="section level2">
<h2 id="saving-the-giotto-object">15. Saving the giotto object<a class="anchor" aria-label="anchor" href="#saving-the-giotto-object"></a>
</h2>
<p>Giotto uses many objects that include pointers to information that
live on disk instead of loading everything into memory. This includes
both giotto image objects (<code>giottoImage</code>,
<code>giottoLargeImage</code>) and also subcellular information
(<code>giottoPoints</code>, <code>giottoPolygon</code>). When saving the
project as a <code>.RDS</code> or <code>.Rdata</code>, these pointers
are broken and can produce errors when loaded again.</p>
<p><code><a href="https://drieslab.github.io/GiottoClass/reference/saveGiotto.html">saveGiotto()</a></code> is a function that can save Giotto Suite
projects into a contained structured directory that can then be properly
loaded again later using <code><a href="https://drieslab.github.io/GiottoClass/reference/loadGiotto.html">loadGiotto()</a></code>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://drieslab.github.io/GiottoClass/reference/saveGiotto.html">saveGiotto</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">fov_join</span>,</span>
<span>           foldername <span class="op">=</span> <span class="st">'new_folder_name'</span>,</span>
<span>           dir <span class="op">=</span> <span class="st">'/directory/to/save/to/'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># R version 4.2.1 (2022-06-23)</span></span>
<span><span class="co"># Platform: x86_64-apple-darwin17.0 (64-bit)</span></span>
<span><span class="co"># Running under: macOS Big Sur 11.6</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Matrix products: default</span></span>
<span><span class="co"># LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># locale:</span></span>
<span><span class="co"># [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># attached base packages:</span></span>
<span><span class="co"># [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># other attached packages:</span></span>
<span><span class="co"># [1] Giotto_3.1   testthat_3.1.5 ggplot2_3.4.0 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># loaded via a namespace (and not attached):</span></span>
<span><span class="co">#   [1] utf8_1.2.2                  reticulate_1.26             R.utils_2.12.2             </span></span>
<span><span class="co">#   [4] tidyselect_1.2.0            htmlwidgets_1.5.4           grid_4.2.1                 </span></span>
<span><span class="co">#   [7] BiocParallel_1.32.3         Rtsne_0.16                  devtools_2.4.5             </span></span>
<span><span class="co">#  [10] scatterpie_0.1.8            munsell_0.5.0               ScaledMatrix_1.6.0         </span></span>
<span><span class="co">#  [13] codetools_0.2-18            ragg_1.2.4                  statmod_1.4.37             </span></span>
<span><span class="co">#  [16] scran_1.24.1                future_1.29.0               miniUI_0.1.1.1             </span></span>
<span><span class="co">#  [19] withr_2.5.0                 colorspace_2.0-3            Biobase_2.56.0             </span></span>
<span><span class="co">#  [22] knitr_1.41                  rstudioapi_0.14             stats4_4.2.1               </span></span>
<span><span class="co">#  [25] SingleCellExperiment_1.18.1 listenv_0.8.0               MatrixGenerics_1.10.0      </span></span>
<span><span class="co">#  [28] labeling_0.4.2              GenomeInfoDbData_1.2.8      polyclip_1.10-4            </span></span>
<span><span class="co">#  [31] farver_2.1.1                rprojroot_2.0.3             parallelly_1.32.1          </span></span>
<span><span class="co">#  [34] vctrs_0.5.1                 generics_0.1.3              xfun_0.35                  </span></span>
<span><span class="co">#  [37] R6_2.5.1                    doParallel_1.0.17           GenomeInfoDb_1.32.4        </span></span>
<span><span class="co">#  [40] clue_0.3-62                 rsvd_1.0.5                  locfit_1.5-9.6             </span></span>
<span><span class="co">#  [43] bitops_1.0-7                cachem_1.0.6                DelayedArray_0.24.0        </span></span>
<span><span class="co">#  [46] assertthat_0.2.1            promises_1.2.0.1            scales_1.2.1               </span></span>
<span><span class="co">#  [49] gtable_0.3.1                beachmat_2.14.0             globals_0.16.2             </span></span>
<span><span class="co">#  [52] processx_3.8.0              rlang_1.0.6                 systemfonts_1.0.4          </span></span>
<span><span class="co">#  [55] GlobalOptions_0.1.2         lazyeval_0.2.2              reshape2_1.4.4             </span></span>
<span><span class="co">#  [58] httpuv_1.6.6                tools_4.2.1                 usethis_2.1.6              </span></span>
<span><span class="co">#  [61] ellipsis_0.3.2              RColorBrewer_1.1-3          BiocGenerics_0.44.0        </span></span>
<span><span class="co">#  [64] rcartocolor_2.0.0           sessioninfo_1.2.2           Rcpp_1.0.9                 </span></span>
<span><span class="co">#  [67] plyr_1.8.8                  sparseMatrixStats_1.10.0    zlibbioc_1.42.0            </span></span>
<span><span class="co">#  [70] purrr_0.3.5                 RCurl_1.98-1.9              ps_1.7.2                   </span></span>
<span><span class="co">#  [73] prettyunits_1.1.1           dbscan_1.1-11               deldir_1.0-6               </span></span>
<span><span class="co">#  [76] GetoptLong_1.0.5            cowplot_1.1.1               urlchecker_1.0.1           </span></span>
<span><span class="co">#  [79] S4Vectors_0.36.0            SummarizedExperiment_1.26.1 ggrepel_0.9.2              </span></span>
<span><span class="co">#  [82] cluster_2.1.4               fs_1.5.2                    here_1.0.1                 </span></span>
<span><span class="co">#  [85] magrittr_2.0.3              data.table_1.14.6           magick_2.7.3               </span></span>
<span><span class="co">#  [88] circlize_0.4.15             matrixStats_0.63.0          pkgload_1.3.1              </span></span>
<span><span class="co">#  [91] mime_0.12                   evaluate_0.18               xtable_1.8-4               </span></span>
<span><span class="co">#  [94] IRanges_2.32.0              shape_1.4.6                 compiler_4.2.1             </span></span>
<span><span class="co">#  [97] tibble_3.1.8                crayon_1.5.2                R.oo_1.25.0                </span></span>
<span><span class="co"># [100] htmltools_0.5.3             ggfun_0.0.8                 later_1.3.0                </span></span>
<span><span class="co"># [103] tidyr_1.2.1                 DBI_1.1.3                   tweenr_2.0.2               </span></span>
<span><span class="co"># [106] ComplexHeatmap_2.12.1       MASS_7.3-58.1               Matrix_1.5-3               </span></span>
<span><span class="co"># [109] brio_1.1.3                  cli_3.4.1                   R.methodsS3_1.8.2          </span></span>
<span><span class="co"># [112] parallel_4.2.1              metapod_1.4.0               igraph_1.3.5               </span></span>
<span><span class="co"># [115] GenomicRanges_1.48.0        pkgconfig_2.0.3             sp_1.5-1                   </span></span>
<span><span class="co"># [118] terra_1.6-41                plotly_4.10.1               scuttle_1.6.3              </span></span>
<span><span class="co"># [121] foreach_1.5.2               dqrng_0.3.0                 XVector_0.36.0             </span></span>
<span><span class="co"># [124] stringr_1.4.1               callr_3.7.3                 digest_0.6.30              </span></span>
<span><span class="co"># [127] RcppAnnoy_0.0.20            rmarkdown_2.18              uwot_0.1.14                </span></span>
<span><span class="co"># [130] edgeR_3.38.4                DelayedMatrixStats_1.20.0   shiny_1.7.3                </span></span>
<span><span class="co"># [133] rjson_0.2.21                lifecycle_1.0.3             jsonlite_1.8.3             </span></span>
<span><span class="co"># [136] BiocNeighbors_1.14.0        desc_1.4.2                  viridisLite_0.4.1          </span></span>
<span><span class="co"># [139] limma_3.54.0                fansi_1.0.3                 pillar_1.8.1               </span></span>
<span><span class="co"># [142] lattice_0.20-45             fastmap_1.1.0               httr_1.4.4                 </span></span>
<span><span class="co"># [145] pkgbuild_1.3.1              glue_1.6.2                  remotes_2.4.2              </span></span>
<span><span class="co"># [148] png_0.1-7                   iterators_1.0.14            bluster_1.6.0              </span></span>
<span><span class="co"># [151] ggforce_0.4.1               stringi_1.7.8               profvis_0.3.7              </span></span>
<span><span class="co"># [154] textshaping_0.3.6           BiocSingular_1.14.0         memoise_2.0.1              </span></span>
<span><span class="co"># [157] dplyr_1.0.10                irlba_2.3.5.1               future.apply_1.10.0     </span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.drieslab.com" class="external-link">Ruben Dries</a>, Jiaji George Chen, <a href="https://josschavezf.github.io" class="external-link">Joselyn C. ChÃ¡vez-Fuentes</a>, <a href="https://labs.icahn.mssm.edu/yuanlab/" class="external-link">Guo-Cheng Yuan</a>, Matthew Oâ€™Brien, Edward Ruiz, Wen Wang, Natalie Del Rossi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
