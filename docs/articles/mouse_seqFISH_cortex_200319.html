<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>seqFISH+ cortex • Giotto</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="seqFISH+ cortex">
<meta property="og:description" content="Giotto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-109153024-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109153024-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Giotto</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Start
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html#description">Description</a>
    </li>
    <li>
      <a href="../articles/getting_started.html#workflow-diagram">Workflow</a>
    </li>
    <li>
      <a href="../articles/getting_started.html#howtos">HOWTOs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Datasets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mouse_seqFISH_cortex_200319.html">mouse seqFISH cortex</a>
    </li>
    <li>
      <a href="../articles/mouse_merFISH_hypoth_preoptic_region_200326.html">mouse hypoth. preopt. region</a>
    </li>
    <li>
      <a href="../articles/mouse_starmap_cortex.html">mouse STARmap cortex</a>
    </li>
    <li>
      <a href="../articles/human_cycif_PDAC_200322.html">human CyCIF PDAC</a>
    </li>
    <li>
      <a href="../articles/mouse_visium_brain_200325.html">mouse Visium brain</a>
    </li>
    <li>
      <a href="../articles/mouse_visium_kidney_200326.html">mouse Visium kidney</a>
    </li>
    <li>
      <a href="../articles/mouse_CODEX_spleen.html">mouse CODEX spleen</a>
    </li>
    <li>
      <a href="../articles/mouse_osmFISH_SScortex.html">mouse osmFISH SScortex</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faqs.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RubD/Giotto">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>seqFISH+ cortex</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RubD/Giotto/blob/master/vignettes/mouse_seqFISH_cortex_200319.Rmd"><code>vignettes/mouse_seqFISH_cortex_200319.Rmd</code></a></small>
      <div class="hidden name"><code>mouse_seqFISH_cortex_200319.Rmd</code></div>

    </div>

    
    
<p>The seqFISH+ data to run this tutorial can be found <a href="https://github.com/RubD/spatial-datasets/tree/master/data/2019_seqfish_plus_SScortex">here</a></p>
<div id="giotto-global-instructions" class="section level2">
<h2 class="hasAnchor">
<a href="#giotto-global-instructions" class="anchor"></a>Giotto global instructions</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># this example was tested with Giotto v.0.3.0</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Giotto</span>)

<span class="co">## create instructions</span>
<span class="co">## instructions allow us to automatically save all plots into a chosen results folder</span>
<span class="no">my_python_path</span> <span class="kw">=</span> <span class="st">"/your/python/path/python"</span>
<span class="no">results_folder</span> <span class="kw">=</span> <span class="st">'/your/results/path/'</span>
<span class="no">instrs</span> <span class="kw">=</span> <span class="fu"><a href="../reference/createGiottoInstructions.html">createGiottoInstructions</a></span>(<span class="kw">python_path</span> <span class="kw">=</span> <span class="no">my_python_path</span>,
                                  <span class="kw">show_plot</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">return_plot</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">save_plot</span> <span class="kw">=</span> <span class="no">T</span>,
                                  <span class="kw">save_dir</span> <span class="kw">=</span> <span class="no">results_folder</span>,
                                  <span class="kw">plot_format</span> <span class="kw">=</span> <span class="st">'png'</span>,
                                  <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">9</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">9</span>)</pre></body></html></div>
</div>
<div id="part-1-data-input" class="section level2">
<h2 class="hasAnchor">
<a href="#part-1-data-input" class="anchor"></a>part 1: Data input</h2>
<ul>
<li>load cortex/svz gene expression matrix<br>
</li>
<li>prepare cell coordinates by stitching imaging fields</li>
</ul>
<p>Several fields - containing 100’s of cells - in the mouse cortex and subventricular zone were imaged. The coordinates of the cells within each field are independent of eachother, so in order to visualize and process all cells together imaging fields will be stitched together by providing x and y-offset values specific to each field. These offset values are known or estimates based on the original raw image:</p>
<center>
<img src="../inst/images/general_figs/cortex_svz_location_fields.png" style="width:50.0%">
</center>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">## A. expression and cell location</span>
<span class="no">data_dir</span> <span class="kw">=</span> <span class="st">'/path/to/data/Seqfish_SS_cortex/'</span>
<span class="no">VC_exprs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">data_dir</span>,<span class="st">"/"</span>, <span class="st">"count_matrix/cortex_svz_expression.txt"</span>))
<span class="no">VC_locs</span> <span class="kw">=</span> <span class="fu">fread</span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">data_dir</span>,<span class="st">"/"</span>, <span class="st">"cell_locations/cortex_svz_centroids_rotated.csv"</span>))

<span class="co">## B. offset file to combine fields</span>
<span class="no">my_offset_file</span> <span class="kw">=</span> <span class="fu">data.table</span>(<span class="kw">field</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>),
                            <span class="kw">x_offset</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1654.97</span>, <span class="fl">1750.75</span>, <span class="fl">1674.35</span>, <span class="fl">675.5</span>, <span class="fl">2048</span>, <span class="fl">675</span>),
                            <span class="kw">y_offset</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, -<span class="fl">1438.02</span>, -<span class="fl">1438.02</span>, <span class="fl">0</span>))
<span class="no">stitch_file</span> <span class="kw">=</span> <span class="fu"><a href="../reference/stitchFieldCoordinates.html">stitchFieldCoordinates</a></span>(<span class="kw">location_file</span> <span class="kw">=</span> <span class="no">VC_locs</span>, <span class="kw">offset_file</span> <span class="kw">=</span> <span class="no">my_offset_file</span>,
                                     <span class="kw">cumulate_offset_x</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">cumulate_offset_y</span> <span class="kw">=</span> <span class="no">F</span>,
                                     <span class="kw">field_col</span> <span class="kw">=</span> <span class="st">'Field of View'</span>,
                                     <span class="kw">reverse_final_x</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">reverse_final_y</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="no">stitch_file</span>    <span class="kw">=</span> <span class="no">stitch_file</span>[,<span class="fu">.</span>(<span class="no">X_final</span>, <span class="no">Y_final</span>)]
<span class="no">my_offset_file</span> <span class="kw">=</span> <span class="no">my_offset_file</span>[,<span class="fu">.</span>(<span class="no">field</span>, <span class="no">x_offset_final</span>, <span class="no">y_offset_final</span>)]</pre></body></html></div>
<hr>
</div>
<div id="part-2-create-giotto-object-process-data" class="section level2">
<h2 class="hasAnchor">
<a href="#part-2-create-giotto-object-process-data" class="anchor"></a>part 2: Create Giotto object &amp; process data</h2>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">## create</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createGiottoObject.html">createGiottoObject</a></span>(<span class="kw">raw_exprs</span> <span class="kw">=</span> <span class="no">VC_exprs</span>, <span class="kw">spatial_locs</span> <span class="kw">=</span> <span class="no">stitch_file</span>,
                              <span class="kw">offset_file</span> <span class="kw">=</span> <span class="no">my_offset_file</span>, <span class="kw">instructions</span> <span class="kw">=</span> <span class="no">instrs</span>)

<span class="co">## add known field annotation</span>
<span class="no">cortex_fields</span> <span class="kw">=</span> <span class="fu">fread</span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">data_dir</span>,<span class="st">"/"</span>, <span class="st">"cortex_fields_info.txt"</span>))
<span class="no">VC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/addCellMetadata.html">addCellMetadata</a></span>(<span class="no">VC_test</span>, <span class="kw">new_metadata</span> <span class="kw">=</span> <span class="no">cortex_fields</span>,
                          <span class="kw">by_column</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">column_cell_ID</span> <span class="kw">=</span> <span class="st">'uniq_ID'</span>)

<span class="co">## subset for cortex only (first 5 fields)</span>
<span class="no">cell_metadata</span> <span class="kw">=</span> <span class="fu"><a href="../reference/pDataDT.html">pDataDT</a></span>(<span class="no">VC_test</span>)
<span class="no">cortex_cell_ids</span> <span class="kw">=</span> <span class="no">cell_metadata</span>[<span class="no">Field_of_View</span> <span class="kw">%in%</span> <span class="fl">0</span>:<span class="fl">4</span>]$<span class="no">cell_ID</span>
<span class="no">VC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/subsetGiotto.html">subsetGiotto</a></span>(<span class="no">VC_test</span>, <span class="kw">cell_ids</span> <span class="kw">=</span> <span class="no">cortex_cell_ids</span>)

<span class="co">## filter</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/filterGiotto.html">filterGiotto</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                        <span class="kw">expression_threshold</span> <span class="kw">=</span> <span class="fl">1</span>,
                        <span class="kw">gene_det_in_min_cells</span> <span class="kw">=</span> <span class="fl">10</span>,
                        <span class="kw">min_det_genes_per_cell</span> <span class="kw">=</span> <span class="fl">10</span>,
                        <span class="kw">expression_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'raw'</span>),
                        <span class="kw">verbose</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="co">## normalize</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/normalizeGiotto.html">normalizeGiotto</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">scalefactor</span> <span class="kw">=</span> <span class="fl">6000</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="co">## add gene &amp; cell statistics</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/addStatistics.html">addStatistics</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>)

<span class="co">## adjust expression matrix for technical or known variables</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/adjustGiottoMatrix.html">adjustGiottoMatrix</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">expression_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'normalized'</span>),
                              <span class="kw">batch_columns</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">covariate_columns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'nr_genes'</span>, <span class="st">'total_expr'</span>),
                              <span class="kw">return_gobject</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                              <span class="kw">update_slot</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'custom'</span>))

<span class="co">## visualize</span>
<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>)</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/2_spatial_locations.png" style="width:10cm">
</center>
</div>
<div id="part-3-dimension-reduction" class="section level2">
<h2 class="hasAnchor">
<a href="#part-3-dimension-reduction" class="anchor"></a>part 3: dimension reduction</h2>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">## highly variable genes (HVG)</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calculateHVG.html">calculateHVG</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'cov_loess'</span>, <span class="kw">difference_in_cov</span> <span class="kw">=</span> <span class="fl">0.1</span>,
                        <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'3_HVGplot'</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">5</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/3_HVGplot.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">## select genes based on HVG and gene statistics, both found in gene metadata</span>
<span class="no">gene_metadata</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fDataDT.html">fDataDT</a></span>(<span class="no">VC_test</span>)
<span class="no">featgenes</span> <span class="kw">=</span> <span class="no">gene_metadata</span>[<span class="no">hvg</span> <span class="kw">==</span> <span class="st">'yes'</span> <span class="kw">&amp;</span> <span class="no">perc_cells</span> <span class="kw">&gt;</span> <span class="fl">4</span> <span class="kw">&amp;</span> <span class="no">mean_expr_det</span> <span class="kw">&gt;</span> <span class="fl">0.5</span>]$<span class="no">gene_ID</span>

<span class="co">## run PCA on expression values (default)</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runPCA.html">runPCA</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">genes_to_use</span> <span class="kw">=</span> <span class="no">featgenes</span>, <span class="kw">scale_unit</span> <span class="kw">=</span> <span class="no">F</span>)

<span class="fu"><a href="../reference/signPCA.html">signPCA</a></span>(<span class="no">VC_test</span>, <span class="kw">genes_to_use</span> <span class="kw">=</span> <span class="no">featgenes</span>, <span class="kw">scale_unit</span> <span class="kw">=</span> <span class="no">F</span>,
        <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'3_screeplot'</span>))

<span class="fu"><a href="../reference/plotPCA.html">plotPCA</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
        <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'3_PCA_reduction'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/3_screeplot.png" style="width:10cm">
</center>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/3_PCA_reduction.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">## run UMAP and tSNE on PCA space (default)</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runUMAP.html">runUMAP</a></span>(<span class="no">VC_test</span>, <span class="kw">dimensions_to_use</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">15</span>, <span class="kw">n_threads</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="fu"><a href="../reference/plotUMAP.html">plotUMAP</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'3_UMAP_reduction'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/3_UMAP_reduction.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runtSNE.html">runtSNE</a></span>(<span class="no">VC_test</span>, <span class="kw">dimensions_to_use</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">30</span>)
<span class="fu"><a href="../reference/plotTSNE.html">plotTSNE</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'3_tSNE_reduction'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/3_tSNE_reduction.png" style="width:10cm">
</center>
</div>
<div id="part-4-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#part-4-cluster" class="anchor"></a>part 4: cluster</h2>
<div class="sourceCode" id="cb8"><html><body><pre class="r">
<span class="co">## sNN network (default)</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createNearestNetwork.html">createNearestNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">dimensions_to_use</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">15</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">15</span>)
<span class="co">## Leiden clustering</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/doLeidenCluster.html">doLeidenCluster</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">resolution</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">n_iterations</span> <span class="kw">=</span> <span class="fl">1000</span>)
<span class="fu"><a href="../reference/plotUMAP.html">plotUMAP</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
         <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'leiden_clus'</span>, <span class="kw">show_NN_network</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'4_UMAP_leiden'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/4_UMAP_leiden.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co">## Leiden subclustering for specified clusters</span>
<span class="no">VC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/doLeidenSubCluster.html">doLeidenSubCluster</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'leiden_clus'</span>,
                             <span class="kw">resolution</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">k_neighbors</span> <span class="kw">=</span> <span class="fl">10</span>,
                             <span class="kw">hvg_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">'cov_loess'</span>, <span class="kw">difference_in_cov</span> <span class="kw">=</span> <span class="fl">0.1</span>),
                             <span class="kw">pca_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'normalized'</span>, <span class="kw">scale_unit</span> <span class="kw">=</span> <span class="no">F</span>),
                             <span class="kw">nn_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">dimensions_to_use</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">5</span>),
                             <span class="kw">selected_clusters</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span>),
                             <span class="kw">name</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>)

<span class="co">## set colors for clusters</span>
<span class="no">subleiden_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1.1</span>, <span class="fl">5.1</span>,  <span class="fl">2.1</span>, <span class="fl">3.1</span>,
                     <span class="fl">4.1</span>,  <span class="fl">4.2</span>, <span class="fl">4.3</span>, <span class="fl">6.2</span>, <span class="fl">6.1</span>,
                     <span class="fl">7.1</span>,  <span class="fl">7.2</span>, <span class="fl">8.1</span>)
<span class="no">subleiden_colors</span> <span class="kw">=</span> <span class="kw pkg">Giotto</span><span class="kw ns">:::</span><span class="fu"><a href="../reference/getDistinctColors.html">getDistinctColors</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">subleiden_order</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">subleiden_colors</span>) <span class="kw">=</span> <span class="no">subleiden_order</span>

<span class="fu"><a href="../reference/plotUMAP.html">plotUMAP</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
         <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>, <span class="kw">cell_color_code</span> <span class="kw">=</span> <span class="no">subleiden_colors</span>,
         <span class="kw">show_NN_network</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>, <span class="kw">show_center_label</span> <span class="kw">=</span> <span class="no">F</span>,
         <span class="kw">legend_text</span> <span class="kw">=</span> <span class="fl">12</span>, <span class="kw">legend_symbol_size</span> <span class="kw">=</span> <span class="fl">3</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'4_UMAP_leiden_subcluster'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/4_UMAP_leiden_subcluster.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">## show cluster relationships</span>
<span class="fu"><a href="../reference/showClusterHeatmap.html">showClusterHeatmap</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>,
                   <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'4_heatmap'</span>, <span class="kw">units</span> <span class="kw">=</span> <span class="st">'cm'</span>),
                   <span class="kw">row_names_gp</span> <span class="kw">=</span> <span class="kw pkg">grid</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(<span class="kw">fontsize</span> <span class="kw">=</span> <span class="fl">9</span>), <span class="kw">column_names_gp</span> <span class="kw">=</span> <span class="kw pkg">grid</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(<span class="kw">fontsize</span> <span class="kw">=</span> <span class="fl">9</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/4_heatmap.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/showClusterDendrogram.html">showClusterDendrogram</a></span>(<span class="no">VC_test</span>, <span class="kw">h</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">rotate</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>,
                      <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'4_dendro'</span>, <span class="kw">units</span> <span class="kw">=</span> <span class="st">'cm'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/4_dendro.png" style="width:10cm">
</center>
</div>
<div id="part-5-visualize-spatial-and-expression-space" class="section level2">
<h2 class="hasAnchor">
<a href="#part-5-visualize-spatial-and-expression-space" class="anchor"></a>part 5: visualize spatial and expression space</h2>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># expression and spatial</span>
<span class="fu"><a href="../reference/spatDimPlot.html">spatDimPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>, <span class="kw">cell_color_code</span> <span class="kw">=</span> <span class="no">subleiden_colors</span>,
            <span class="kw">dim_point_size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">spat_point_size</span> <span class="kw">=</span> <span class="fl">2</span>,
            <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'5_covis_leiden'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/5_covis_leiden.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># selected groups and provide new colors</span>
<span class="no">groups_of_interest</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4.1</span>, <span class="fl">6.1</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>)
<span class="no">group_colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>, <span class="st">'purple'</span>); <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">group_colors</span>) <span class="kw">=</span> <span class="no">groups_of_interest</span>

<span class="fu"><a href="../reference/spatDimPlot.html">spatDimPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>,
            <span class="kw">dim_point_size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">spat_point_size</span> <span class="kw">=</span> <span class="fl">2</span>,
            <span class="kw">select_cell_groups</span> <span class="kw">=</span> <span class="no">groups_of_interest</span>, <span class="kw">cell_color_code</span> <span class="kw">=</span> <span class="no">group_colors</span>,
            <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'5_covis_leiden_selected'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/5_covis_leiden_selected.png" style="width:10cm">
</center>
</div>
<div id="part-6-cell-type-marker-gene-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#part-6-cell-type-marker-gene-detection" class="anchor"></a>part 6: cell type marker gene detection</h2>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co">## gini ##</span>
<span class="no">gini_markers_subclusters</span> <span class="kw">=</span> <span class="fu"><a href="../reference/findMarkers_one_vs_all.html">findMarkers_one_vs_all</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                                                  <span class="kw">method</span> <span class="kw">=</span> <span class="st">'gini'</span>,
                                                  <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'normalized'</span>,
                                                  <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>,
                                                  <span class="kw">min_genes</span> <span class="kw">=</span> <span class="fl">20</span>,
                                                  <span class="kw">min_expr_gini_score</span> <span class="kw">=</span> <span class="fl">0.5</span>,
                                                  <span class="kw">min_det_gini_score</span> <span class="kw">=</span> <span class="fl">0.5</span>)
<span class="no">topgenes_gini</span> <span class="kw">=</span> <span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">2</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cluster'</span>]

<span class="co"># violinplot</span>
<span class="fu"><a href="../reference/violinPlot.html">violinPlot</a></span>(<span class="no">VC_test</span>, <span class="kw">genes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">topgenes_gini</span>$<span class="no">genes</span>), <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>,
           <span class="kw">strip_text</span> <span class="kw">=</span> <span class="fl">8</span>, <span class="kw">strip_position</span> <span class="kw">=</span> <span class="st">'right'</span>, <span class="kw">cluster_custom_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">topgenes_gini</span>$<span class="no">cluster</span>),
           <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'6_violinplot_gini'</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">10</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/6_violinplot_gini.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># cluster heatmap</span>
<span class="no">topgenes_gini2</span> <span class="kw">=</span> <span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">6</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cluster'</span>]
<span class="fu"><a href="../reference/plotMetaDataHeatmap.html">plotMetaDataHeatmap</a></span>(<span class="no">VC_test</span>, <span class="kw">selected_genes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">topgenes_gini2</span>$<span class="no">genes</span>),
                    <span class="kw">custom_gene_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">topgenes_gini2</span>$<span class="no">genes</span>),
                    <span class="kw">custom_cluster_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">topgenes_gini2</span>$<span class="no">cluster</span>),
                    <span class="kw">metadata_cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'sub_leiden_clus_select'</span>), <span class="kw">x_text_size</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">y_text_size</span> <span class="kw">=</span> <span class="fl">10</span>,
                    <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'6_metaheatmap_gini'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/6_metaheatmap_gini2.png" style="width:10cm">
</center>
</div>
<div id="part-7-cell-type-annotation" class="section level2">
<h2 class="hasAnchor">
<a href="#part-7-cell-type-annotation" class="anchor"></a>part 7: cell type annotation</h2>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co">## general cell types</span>
<span class="co"># create vector with names</span>
<span class="no">clusters_cell_types_cortex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'microglia'</span>, <span class="st">'L4 eNeuron'</span>, <span class="st">'endothelial'</span>,
                               <span class="st">'astrocytes'</span>, <span class="st">'Adarb2 iNeuron'</span>, <span class="st">'Lhx6 iNeuron'</span>,
                               <span class="st">'L6 eNeuron'</span>, <span class="st">'L5 eNeuron'</span>, <span class="st">'L2/3 eNeuron'</span>,
                               <span class="st">'OPC'</span>, <span class="st">'Olig'</span>, <span class="st">'mural'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">clusters_cell_types_cortex</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">8.1</span>, <span class="fl">2.1</span>, <span class="fl">7.1</span>,
                                      <span class="fl">4.1</span>, <span class="fl">6.2</span>, <span class="fl">6.1</span>,
                                      <span class="fl">1.1</span>, <span class="fl">5.1</span>, <span class="fl">3.1</span>,
                                      <span class="fl">4.3</span>, <span class="fl">4.2</span>, <span class="fl">7.2</span>)

<span class="no">VC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/annotateGiotto.html">annotateGiotto</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">annotation_vector</span> <span class="kw">=</span> <span class="no">clusters_cell_types_cortex</span>,
                         <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'sub_leiden_clus_select'</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">'cell_types'</span>)

<span class="co"># cell type order and colors</span>
<span class="no">cell_type_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'L6 eNeuron'</span>, <span class="st">'L5 eNeuron'</span>, <span class="st">'L4 eNeuron'</span>, <span class="st">'L2/3 eNeuron'</span>,
                    <span class="st">'astrocytes'</span>, <span class="st">'Olig'</span>, <span class="st">'OPC'</span>,<span class="st">'Adarb2 iNeuron'</span>, <span class="st">'Lhx6 iNeuron'</span>,
                    <span class="st">'endothelial'</span>, <span class="st">'mural'</span>, <span class="st">'microglia'</span>)
<span class="no">cell_type_colors</span> <span class="kw">=</span> <span class="kw pkg">Giotto</span><span class="kw ns">:::</span><span class="fu"><a href="../reference/getDistinctColors.html">getDistinctColors</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">cell_type_order</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">cell_type_colors</span>) <span class="kw">=</span> <span class="no">cell_type_order</span>

<span class="co">## violinplot</span>
<span class="fu"><a href="../reference/violinPlot.html">violinPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">genes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">topgenes_gini</span>$<span class="no">genes</span>),
           <span class="kw">strip_text</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">strip_position</span> <span class="kw">=</span> <span class="st">'right'</span>,
           <span class="kw">cluster_custom_order</span> <span class="kw">=</span> <span class="no">cell_type_order</span>,
           <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>, <span class="kw">color_violin</span> <span class="kw">=</span> <span class="st">'cluster'</span>,
           <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'7_violinplot'</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">5</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/7_violinplot.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co">## co-visualization</span>
<span class="fu"><a href="../reference/spatDimPlot.html">spatDimPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
            <span class="kw">dim_point_size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">spat_point_size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">dim_show_cluster_center</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">dim_show_center_label</span> <span class="kw">=</span> <span class="no">T</span>,
            <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'7_covisualization'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/7_covisualization.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="co">## heatmap genes vs cells</span>
<span class="no">gini_markers_subclusters</span>[, <span class="no">cell_types</span> <span class="kw">:=</span> <span class="no">clusters_cell_types_cortex</span>[<span class="no">cluster</span>] ]
<span class="no">gini_markers_subclusters</span>[, <span class="no">cell_types</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">cell_types</span>, <span class="no">cell_type_order</span>)]
<span class="fu">setorder</span>(<span class="no">gini_markers_subclusters</span>, <span class="no">cell_types</span>)

<span class="fu"><a href="../reference/plotHeatmap.html">plotHeatmap</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
            <span class="kw">genes</span> <span class="kw">=</span> <span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">3</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cell_types'</span>]$<span class="no">genes</span>,
            <span class="kw">gene_order</span> <span class="kw">=</span> <span class="st">'custom'</span>,
            <span class="kw">gene_custom_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">3</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cluster'</span>]$<span class="no">genes</span>),
            <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>, <span class="kw">cluster_order</span> <span class="kw">=</span> <span class="st">'custom'</span>,
            <span class="kw">cluster_custom_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">3</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cell_types'</span>]$<span class="no">cell_types</span>),
            <span class="kw">legend_nrows</span> <span class="kw">=</span> <span class="fl">2</span>,
            <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'7_heatmap'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/7_heatmap.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="../reference/plotHeatmap.html">plotHeatmap</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">cluster_color_code</span> <span class="kw">=</span> <span class="no">cell_type_colors</span>,
            <span class="kw">genes</span> <span class="kw">=</span> <span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">6</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cell_types'</span>]$<span class="no">genes</span>,
            <span class="kw">gene_order</span> <span class="kw">=</span> <span class="st">'custom'</span>,
            <span class="kw">gene_label_selection</span> <span class="kw">=</span> <span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">2</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cluster'</span>]$<span class="no">genes</span>,
            <span class="kw">gene_custom_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">6</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cluster'</span>]$<span class="no">genes</span>),
            <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>, <span class="kw">cluster_order</span> <span class="kw">=</span> <span class="st">'custom'</span>,
            <span class="kw">cluster_custom_order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">gini_markers_subclusters</span>[, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.SD</span>, <span class="fl">3</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">'cell_types'</span>]$<span class="no">cell_types</span>),
            <span class="kw">legend_nrows</span> <span class="kw">=</span> <span class="fl">2</span>,
            <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'7_heatmap_selected'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/7_heatmap_selected.png" style="width:10cm">
</center>
</div>
<div id="part-8-spatial-grid" class="section level2">
<h2 class="hasAnchor">
<a href="#part-8-spatial-grid" class="anchor"></a>part 8: spatial grid</h2>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co">## spatial grid</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createSpatialGrid.html">createSpatialGrid</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                             <span class="kw">sdimx_stepsize</span> <span class="kw">=</span> <span class="fl">500</span>,
                             <span class="kw">sdimy_stepsize</span> <span class="kw">=</span> <span class="fl">500</span>,
                             <span class="kw">minimum_padding</span> <span class="kw">=</span> <span class="fl">50</span>)

<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">show_grid</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">1.5</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'8_grid'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/8_grid.png" style="width:10cm">
</center>
</div>
<div id="part-9-spatial-network" class="section level2">
<h2 class="hasAnchor">
<a href="#part-9-spatial-network" class="anchor"></a>part 9: spatial network</h2>
<div class="sourceCode" id="cb21"><html><body><pre class="r">
<span class="co">## delaunay network: stats + creation</span>
<span class="fu"><a href="../reference/plotStatDelaunayNetwork.html">plotStatDelaunayNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">maximum_distance</span> <span class="kw">=</span> <span class="fl">400</span>, <span class="kw">save_plot</span> <span class="kw">=</span> <span class="no">F</span>)
<span class="no">VC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/createSpatialNetwork.html">createSpatialNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">minimum_k</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">maximum_distance_delaunay</span> <span class="kw">=</span> <span class="fl">400</span>)

<span class="co">## create spatial networks based on k and/or distance from centroid</span>
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createSpatialNetwork.html">createSpatialNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'kNN'</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">'spatial_network'</span>)
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createSpatialNetwork.html">createSpatialNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'kNN'</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">'large_network'</span>)
<span class="no">VC_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createSpatialNetwork.html">createSpatialNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'kNN'</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">100</span>,
                                <span class="kw">maximum_distance_knn</span> <span class="kw">=</span> <span class="fl">200</span>, <span class="kw">minimum_k</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">'distance_network'</span>)

<span class="co">## visualize different spatial networks on first field (~ layer 1)</span>
<span class="no">cell_metadata</span> <span class="kw">=</span> <span class="fu"><a href="../reference/pDataDT.html">pDataDT</a></span>(<span class="no">VC_test</span>)
<span class="no">field1_ids</span> <span class="kw">=</span> <span class="no">cell_metadata</span>[<span class="no">Field_of_View</span> <span class="kw">==</span> <span class="fl">0</span>]$<span class="no">cell_ID</span>
<span class="no">subVC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/subsetGiotto.html">subsetGiotto</a></span>(<span class="no">VC_test</span>, <span class="kw">cell_ids</span> <span class="kw">=</span> <span class="no">field1_ids</span>)

<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">subVC_test</span>, <span class="kw">show_network</span> <span class="kw">=</span> <span class="no">T</span>,
         <span class="kw">network_color</span> <span class="kw">=</span> <span class="st">'blue'</span>, <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'Delaunay_network'</span>,
         <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'9_spatial_network_delaunay'</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">6</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/9_spatial_network_delaunay.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">subVC_test</span>, <span class="kw">show_network</span> <span class="kw">=</span> <span class="no">T</span>,
         <span class="kw">network_color</span> <span class="kw">=</span> <span class="st">'blue'</span>, <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'spatial_network'</span>,
         <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'9_spatial_network_k3'</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">6</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/9_spatial_network_k3.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">subVC_test</span>, <span class="kw">show_network</span> <span class="kw">=</span> <span class="no">T</span>,
         <span class="kw">network_color</span> <span class="kw">=</span> <span class="st">'blue'</span>, <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'large_network'</span>,
         <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'9_spatial_network_k10'</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">6</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/9_spatial_network_k10.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">subVC_test</span>, <span class="kw">show_network</span> <span class="kw">=</span> <span class="no">T</span>,
         <span class="kw">network_color</span> <span class="kw">=</span> <span class="st">'blue'</span>, <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'distance_network'</span>,
         <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'9_spatial_network_dist'</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">6</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/9_spatial_network_dist.png" style="width:10cm">
</center>
</div>
<div id="part-10-spatial-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#part-10-spatial-genes" class="anchor"></a>part 10: spatial genes</h2>
<div id="individual-spatial-genes" class="section level3">
<h3 class="hasAnchor">
<a href="#individual-spatial-genes" class="anchor"></a>Individual spatial genes</h3>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="co"># 3 new methods to identify spatial genes</span>
<span class="no">km_spatialgenes</span> <span class="kw">=</span> <span class="fu"><a href="../reference/binSpect.html">binSpect</a></span>(<span class="no">VC_test</span>)
<span class="fu"><a href="../reference/spatGenePlot.html">spatGenePlot</a></span>(<span class="no">VC_test</span>, <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>, <span class="kw">genes</span> <span class="kw">=</span> <span class="no">km_spatialgenes</span>[<span class="fl">1</span>:<span class="fl">6</span>]$<span class="no">genes</span>,
             <span class="kw">point_shape</span> <span class="kw">=</span> <span class="st">'border'</span>, <span class="kw">point_border_stroke</span> <span class="kw">=</span> <span class="fl">0.1</span>,
             <span class="kw">show_network</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">network_color</span> <span class="kw">=</span> <span class="st">'lightgrey'</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>,
             <span class="kw">genes_high_color</span> <span class="kw">=</span> <span class="st">'red'</span>, <span class="kw">genes_mid_color</span> <span class="kw">=</span> <span class="st">'white'</span>, <span class="kw">genes_low_color</span> <span class="kw">=</span> <span class="st">'white'</span>,
             <span class="kw">cow_n_col</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'10_spatialgenes_km'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/10_spatialgenes_km.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">rank_spatialgenes</span> <span class="kw">=</span> <span class="fu"><a href="../reference/binSpect.html">binSpect</a></span>(<span class="no">VC_test</span>, <span class="kw">bin_method</span> <span class="kw">=</span> <span class="st">'rank'</span>)
<span class="fu"><a href="../reference/spatGenePlot.html">spatGenePlot</a></span>(<span class="no">VC_test</span>, <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>, <span class="kw">genes</span> <span class="kw">=</span> <span class="no">rank_spatialgenes</span>[<span class="fl">1</span>:<span class="fl">6</span>]$<span class="no">genes</span>,
             <span class="kw">point_shape</span> <span class="kw">=</span> <span class="st">'border'</span>, <span class="kw">point_border_stroke</span> <span class="kw">=</span> <span class="fl">0.1</span>,
             <span class="kw">show_network</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">network_color</span> <span class="kw">=</span> <span class="st">'lightgrey'</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>,
             <span class="kw">genes_high_color</span> <span class="kw">=</span> <span class="st">'red'</span>, <span class="kw">genes_mid_color</span> <span class="kw">=</span> <span class="st">'white'</span>, <span class="kw">genes_low_color</span> <span class="kw">=</span> <span class="st">'white'</span>,
             <span class="kw">cow_n_col</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'10_spatialgenes_rank'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/10_spatialgenes_rank.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">silh_spatialgenes</span> <span class="kw">=</span> <span class="fu"><a href="../reference/silhouetteRank.html">silhouetteRank</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>)
<span class="fu"><a href="../reference/spatGenePlot.html">spatGenePlot</a></span>(<span class="no">VC_test</span>, <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>, <span class="kw">genes</span> <span class="kw">=</span> <span class="no">silh_spatialgenes</span>[<span class="fl">1</span>:<span class="fl">6</span>]$<span class="no">genes</span>,
             <span class="kw">point_shape</span> <span class="kw">=</span> <span class="st">'border'</span>, <span class="kw">point_border_stroke</span> <span class="kw">=</span> <span class="fl">0.1</span>,
             <span class="kw">show_network</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">network_color</span> <span class="kw">=</span> <span class="st">'lightgrey'</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>,
             <span class="kw">genes_high_color</span> <span class="kw">=</span> <span class="st">'red'</span>, <span class="kw">genes_mid_color</span> <span class="kw">=</span> <span class="st">'white'</span>, <span class="kw">genes_low_color</span> <span class="kw">=</span> <span class="st">'white'</span>,
             <span class="kw">cow_n_col</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'10_spatialgenes_silh'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/10_spatialgenes_silh.png" style="width:10cm">
</center>
</div>
<div id="spatial-genes-co-expression-modules" class="section level3">
<h3 class="hasAnchor">
<a href="#spatial-genes-co-expression-modules" class="anchor"></a>Spatial genes co-expression modules</h3>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="co">## spatial co-expression patterns ##</span>
<span class="no">ext_spatial_genes</span> <span class="kw">=</span> <span class="no">kmtest</span>[<span class="fl">1</span>:<span class="fl">500</span>]$<span class="no">genes</span>

<span class="co"># 1. calculate gene spatial correlation and single-cell correlation </span>
<span class="co"># create spatial correlation object</span>
<span class="no">spat_cor_netw_DT</span> <span class="kw">=</span> <span class="fu"><a href="../reference/detectSpatialCorGenes.html">detectSpatialCorGenes</a></span>(<span class="no">VC_test</span>,
                                         <span class="kw">method</span> <span class="kw">=</span> <span class="st">'network'</span>, <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'Delaunay_network'</span>,
                                         <span class="kw">subset_genes</span> <span class="kw">=</span> <span class="no">ext_spatial_genes</span>)


<span class="co"># 2. cluster correlated genes &amp; visualize</span>
<span class="no">spat_cor_netw_DT</span> <span class="kw">=</span> <span class="fu"><a href="../reference/clusterSpatialCorGenes.html">clusterSpatialCorGenes</a></span>(<span class="no">spat_cor_netw_DT</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">'spat_netw_clus'</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">8</span>)

<span class="fu"><a href="../reference/heatmSpatialCorGenes.html">heatmSpatialCorGenes</a></span>(<span class="no">VC_test</span>, <span class="kw">spatCorObject</span> <span class="kw">=</span> <span class="no">spat_cor_netw_DT</span>, <span class="kw">use_clus_name</span> <span class="kw">=</span> <span class="st">'spat_netw_clus'</span>,
                     <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'10b_spatialcoexpression_heatmap'</span>,
                                    <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">8</span>, <span class="kw">units</span> <span class="kw">=</span> <span class="st">'cm'</span>),
                     <span class="kw">heatmap_legend_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="kw">NULL</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/10b_spatialcoexpression_heatmap.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="co"># 3. rank spatial correlated clusters and show genes for selected clusters</span>
<span class="no">netw_ranks</span> <span class="kw">=</span> <span class="fu"><a href="../reference/rankSpatialCorGroups.html">rankSpatialCorGroups</a></span>(<span class="no">VC_test</span>, <span class="kw">spatCorObject</span> <span class="kw">=</span> <span class="no">spat_cor_netw_DT</span>, <span class="kw">use_clus_name</span> <span class="kw">=</span> <span class="st">'spat_netw_clus'</span>,
                                  <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'10b_spatialcoexpression_rank'</span>,
                                                 <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">5</span>))

<span class="no">top_netw_spat_cluster</span> <span class="kw">=</span> <span class="fu"><a href="../reference/showSpatialCorGenes.html">showSpatialCorGenes</a></span>(<span class="no">spat_cor_netw_DT</span>, <span class="kw">use_clus_name</span> <span class="kw">=</span> <span class="st">'spat_netw_clus'</span>,
                                            <span class="kw">selected_clusters</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">show_top_genes</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/10b_spatialcoexpression_rank.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="co"># 5. create metagene enrichment score for clusters</span>
<span class="no">cluster_genes_DT</span> <span class="kw">=</span> <span class="fu"><a href="../reference/showSpatialCorGenes.html">showSpatialCorGenes</a></span>(<span class="no">spat_cor_netw_DT</span>, <span class="kw">use_clus_name</span> <span class="kw">=</span> <span class="st">'spat_netw_clus'</span>, <span class="kw">show_top_genes</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">cluster_genes</span> <span class="kw">=</span> <span class="no">cluster_genes_DT</span>$<span class="no">clus</span>; <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">cluster_genes</span>) <span class="kw">=</span> <span class="no">cluster_genes_DT</span>$<span class="no">gene_ID</span>

<span class="no">VC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/createMetagenes.html">createMetagenes</a></span>(<span class="no">VC_test</span>, <span class="kw">gene_clusters</span> <span class="kw">=</span> <span class="no">cluster_genes</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">'cluster_metagene'</span>)

<span class="fu"><a href="../reference/spatCellPlot.html">spatCellPlot</a></span>(<span class="no">VC_test</span>,
             <span class="kw">spat_enr_names</span> <span class="kw">=</span> <span class="st">'cluster_metagene'</span>,
             <span class="kw">cell_annotation_values</span> <span class="kw">=</span> <span class="no">netw_ranks</span>$<span class="no">clusters</span>,
             <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">1.5</span>, <span class="kw">cow_n_col</span> <span class="kw">=</span> <span class="fl">3</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'10b_spatialcoexpression_metagenes'</span>,
                            <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">11</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">6</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/10b_spatialcoexpression_metagenes.png" style="width:10cm">
</center>
</div>
</div>
<div id="part-11-hmrf-spatial-domains" class="section level2">
<h2 class="hasAnchor">
<a href="#part-11-hmrf-spatial-domains" class="anchor"></a>part 11: HMRF spatial domains</h2>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">hmrf_folder</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">results_folder</span>,<span class="st">'/'</span>,<span class="st">'11_HMRF/'</span>)
<span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">hmrf_folder</span>)) <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="no">hmrf_folder</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="no">my_spatial_genes</span> <span class="kw">=</span> <span class="no">km_spatialgenes</span>[<span class="fl">1</span>:<span class="fl">100</span>]$<span class="no">genes</span>

<span class="co"># do HMRF with different betas</span>
<span class="no">HMRF_spatial_genes</span> <span class="kw">=</span> <span class="fu"><a href="../reference/doHMRF.html">doHMRF</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                            <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>,
                            <span class="kw">spatial_genes</span> <span class="kw">=</span> <span class="no">my_spatial_genes</span>,
                            <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'Delaunay_network'</span>,
                            <span class="kw">k</span> <span class="kw">=</span> <span class="fl">9</span>,
                            <span class="kw">betas</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">28</span>,<span class="fl">2</span>,<span class="fl">3</span>),
                            <span class="kw">output_folder</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">hmrf_folder</span>, <span class="st">'/'</span>, <span class="st">'Spatial_genes/SG_top100_k9_scaled'</span>))


<span class="co">## view results of HMRF</span>
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">28</span>, <span class="fl">32</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">2</span>)) {
  <span class="fu"><a href="../reference/viewHMRFresults2D.html">viewHMRFresults2D</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                    <span class="kw">HMRFoutput</span> <span class="kw">=</span> <span class="no">HMRF_spatial_genes</span>,
                    <span class="kw">k</span> <span class="kw">=</span> <span class="fl">9</span>, <span class="kw">betas_to_view</span> <span class="kw">=</span> <span class="no">i</span>,
                    <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2</span>)
}


<span class="co">## add HMRF of interest to giotto object</span>
<span class="no">VC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/addHMRF.html">addHMRF</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                  <span class="kw">HMRFoutput</span> <span class="kw">=</span> <span class="no">HMRF_spatial_genes</span>,
                  <span class="kw">k</span> <span class="kw">=</span> <span class="fl">9</span>, <span class="kw">betas_to_add</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">28</span>),
                  <span class="kw">hmrf_name</span> <span class="kw">=</span> <span class="st">'HMRF_2'</span>)

<span class="co">## visualize</span>
<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'HMRF_2_k9_b.28'</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">coord_fix_ratio</span> <span class="kw">=</span> <span class="fl">1</span>,
         <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'11_HMRF_2_k9_b.28'</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">9</span>, <span class="kw">save_format</span> <span class="kw">=</span> <span class="st">'pdf'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/11_HMRF_2_k9_b.28.png" style="width:10cm">
</center>
</div>
<div id="part-12-cell-neighborhood-cell-typecell-type-interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#part-12-cell-neighborhood-cell-typecell-type-interactions" class="anchor"></a>part 12: cell neighborhood: cell-type/cell-type interactions</h2>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">cell_proximities</span> <span class="kw">=</span> <span class="fu"><a href="../reference/cellProximityEnrichment.html">cellProximityEnrichment</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                                           <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
                                           <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'Delaunay_network'</span>,
                                           <span class="kw">adjust_method</span> <span class="kw">=</span> <span class="st">'fdr'</span>,
                                           <span class="kw">number_of_simulations</span> <span class="kw">=</span> <span class="fl">2000</span>)

<span class="co">## barplot</span>
<span class="fu"><a href="../reference/cellProximityBarplot.html">cellProximityBarplot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">CPscore</span> <span class="kw">=</span> <span class="no">cell_proximities</span>, <span class="kw">min_orig_ints</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">min_sim_ints</span> <span class="kw">=</span> <span class="fl">5</span>,
                     <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'12_barplot_cell_cell_enrichment'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/12_barplot_cell_cell_enrichment.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="co">## heatmap</span>
<span class="fu"><a href="../reference/cellProximityHeatmap.html">cellProximityHeatmap</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">CPscore</span> <span class="kw">=</span> <span class="no">cell_proximities</span>, <span class="kw">order_cell_types</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="no">T</span>,
                     <span class="kw">color_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1.5</span>, <span class="fl">0</span>, <span class="fl">1.5</span>), <span class="kw">color_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'blue'</span>, <span class="st">'white'</span>, <span class="st">'red'</span>),
                     <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'12_heatmap_cell_cell_enrichment'</span>, <span class="kw">unit</span> <span class="kw">=</span> <span class="st">'in'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/12_heatmap_cell_cell_enrichment.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="co">## network</span>
<span class="fu"><a href="../reference/cellProximityNetwork.html">cellProximityNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">CPscore</span> <span class="kw">=</span> <span class="no">cell_proximities</span>, <span class="kw">remove_self_edges</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">only_show_enrichment_edges</span> <span class="kw">=</span> <span class="no">T</span>,
                     <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'12_network_cell_cell_enrichment'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/12_network_cell_cell_enrichment.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="co">## network with self-edges</span>
<span class="fu"><a href="../reference/cellProximityNetwork.html">cellProximityNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">CPscore</span> <span class="kw">=</span> <span class="no">cell_proximities</span>,
                     <span class="kw">remove_self_edges</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">self_loop_strength</span> <span class="kw">=</span> <span class="fl">0.3</span>,
                     <span class="kw">only_show_enrichment_edges</span> <span class="kw">=</span> <span class="no">F</span>,
                     <span class="kw">rescale_edge_weights</span> <span class="kw">=</span> <span class="no">T</span>,
                     <span class="kw">node_size</span> <span class="kw">=</span> <span class="fl">8</span>,
                     <span class="kw">edge_weight_range_depletion</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>),
                     <span class="kw">edge_weight_range_enrichment</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">5</span>),
                     <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'12_network_cell_cell_enrichment_self'</span>,
                                    <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">save_format</span> <span class="kw">=</span> <span class="st">'pdf'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/12_network_cell_cell_enrichment_self.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="co">## visualization of specific cell types</span>
<span class="co"># Option 1</span>
<span class="no">spec_interaction</span> <span class="kw">=</span> <span class="st">"astrocytes--Olig"</span>
<span class="fu"><a href="../reference/cellProximitySpatPlot2D.html">cellProximitySpatPlot2D</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                        <span class="kw">interaction_name</span> <span class="kw">=</span> <span class="no">spec_interaction</span>,
                        <span class="kw">show_network</span> <span class="kw">=</span> <span class="no">T</span>,
                        <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
                        <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
                        <span class="kw">cell_color_code</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">astrocytes</span> <span class="kw">=</span> <span class="st">'lightblue'</span>, <span class="kw">Olig</span> <span class="kw">=</span> <span class="st">'red'</span>),
                        <span class="kw">point_size_select</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">point_size_other</span> <span class="kw">=</span> <span class="fl">2</span>,
                        <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'12_cell_cell_enrichment_selected'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/12_cell_cell_enrichment_selected.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="co"># Option 2: create additional metadata</span>
<span class="no">VC_test</span> <span class="kw">=</span> <span class="fu"><a href="../reference/addCellIntMetadata.html">addCellIntMetadata</a></span>(<span class="no">VC_test</span>,
                             <span class="kw">spatial_network</span> <span class="kw">=</span> <span class="st">'spatial_network'</span>,
                             <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
                             <span class="kw">cell_interaction</span> <span class="kw">=</span> <span class="no">spec_interaction</span>,
                             <span class="kw">name</span> <span class="kw">=</span> <span class="st">'astro_olig_ints'</span>)
<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="no">VC_test</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'astro_olig_ints'</span>,
         <span class="kw">select_cell_groups</span> <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'other_astrocytes'</span>, <span class="st">'other_Olig'</span>, <span class="st">'select_astrocytes'</span>, <span class="st">'select_Olig'</span>),
         <span class="kw">legend_symbol_size</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'12_cell_cell_enrichment_sel_vs_not'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/12_cell_cell_enrichment_sel_vs_not.png" style="width:10cm">
</center>
</div>
<div id="part-13-cell-neighborhood-interaction-changed-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#part-13-cell-neighborhood-interaction-changed-genes" class="anchor"></a>part 13: cell neighborhood: interaction changed genes</h2>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="co">## select top 25th highest expressing genes</span>
<span class="no">gene_metadata</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fDataDT.html">fDataDT</a></span>(<span class="no">VC_test</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">gene_metadata</span>$<span class="no">nr_cells</span>, <span class="no">gene_metadata</span>$<span class="no">mean_expr</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">gene_metadata</span>$<span class="no">nr_cells</span>, <span class="no">gene_metadata</span>$<span class="no">mean_expr_det</span>)

<span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">gene_metadata</span>$<span class="no">mean_expr_det</span>)
<span class="no">high_expressed_genes</span> <span class="kw">=</span> <span class="no">gene_metadata</span>[<span class="no">mean_expr_det</span> <span class="kw">&gt;</span> <span class="fl">1.31</span>]$<span class="no">gene_ID</span>

<span class="co">## identify genes that are associated with proximity to other cell types</span>
<span class="no">CPGscoresHighGenes</span> <span class="kw">=</span>  <span class="fu"><a href="../reference/findCPG.html">findCPG</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                              <span class="kw">selected_genes</span> <span class="kw">=</span> <span class="no">high_expressed_genes</span>,
                              <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'Delaunay_network'</span>,
                              <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
                              <span class="kw">diff_test</span> <span class="kw">=</span> <span class="st">'permutation'</span>,
                              <span class="kw">adjust_method</span> <span class="kw">=</span> <span class="st">'fdr'</span>,
                              <span class="kw">nr_permutations</span> <span class="kw">=</span> <span class="fl">2000</span>,
                              <span class="kw">do_parallel</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co">## visualize all genes</span>
<span class="fu"><a href="../reference/plotCellProximityGenes.html">plotCellProximityGenes</a></span>(<span class="no">VC_test</span>, <span class="kw">cpgObject</span> <span class="kw">=</span> <span class="no">CPGscoresHighGenes</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'dotplot'</span>,
                       <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'13_CPG_dotplot'</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">5</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/13_CPG_dotplot.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="co">## filter genes</span>
<span class="no">CPGscoresFilt</span> <span class="kw">=</span> <span class="fu"><a href="../reference/filterCPG.html">filterCPG</a></span>(<span class="no">CPGscoresHighGenes</span>)

<span class="co">## visualize subset of interaction changed genes (ICGs)</span>
<span class="no">ICG_genes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Jakmip1'</span>, <span class="st">'Golgb1'</span>, <span class="st">'Dact2'</span>, <span class="st">'Ddx27'</span>, <span class="st">'Abl1'</span>, <span class="st">'Zswim8'</span>)
<span class="no">ICG_genes_types</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Lhx6 iNeuron'</span>, <span class="st">'Lhx6 iNeuron'</span>, <span class="st">'L4 eNeuron'</span>, <span class="st">'L4 eNeuron'</span>, <span class="st">'astrocytes'</span>, <span class="st">'astrocytes'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">ICG_genes</span>) <span class="kw">=</span> <span class="no">ICG_genes_types</span>

<span class="fu"><a href="../reference/plotICG.html">plotICG</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
        <span class="kw">cpgObject</span> <span class="kw">=</span> <span class="no">CPGscoresHighGenes</span>,
        <span class="kw">source_type</span> <span class="kw">=</span> <span class="st">'endothelial'</span>,
        <span class="kw">source_markers</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Pltp'</span>, <span class="st">'Cldn5'</span>, <span class="st">'Apcdd1'</span>),
        <span class="kw">ICG_genes</span> <span class="kw">=</span> <span class="no">ICG_genes</span>,
        <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'13_ICG_barplot'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/13_ICG_barplot.png" style="width:10cm">
</center>
</div>
<div id="part-14-cell-neighborhood-ligand-receptor-cell-cell-communication" class="section level2">
<h2 class="hasAnchor">
<a href="#part-14-cell-neighborhood-ligand-receptor-cell-cell-communication" class="anchor"></a>part 14: cell neighborhood: ligand-receptor cell-cell communication</h2>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="co"># LR expression</span>
<span class="co"># LR activity changes</span>
<span class="no">LR_data</span> <span class="kw">=</span> <span class="fu">fread</span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"mouse_ligand_receptors.txt"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">'Giotto'</span>))

<span class="no">LR_data</span>[, <span class="no">ligand_det</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">mouseLigand</span> <span class="kw">%in%</span> <span class="no">VC_test</span>@<span class="kw">gene_ID</span>, <span class="no">T</span>, <span class="no">F</span>)]
<span class="no">LR_data</span>[, <span class="no">receptor_det</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">mouseReceptor</span> <span class="kw">%in%</span> <span class="no">VC_test</span>@<span class="kw">gene_ID</span>, <span class="no">T</span>, <span class="no">F</span>)]
<span class="no">LR_data_det</span> <span class="kw">=</span> <span class="no">LR_data</span>[<span class="no">ligand_det</span> <span class="kw">==</span> <span class="no">T</span> <span class="kw">&amp;</span> <span class="no">receptor_det</span> <span class="kw">==</span> <span class="no">T</span>]
<span class="no">select_ligands</span> <span class="kw">=</span> <span class="no">LR_data_det</span>$<span class="no">mouseLigand</span>
<span class="no">select_receptors</span> <span class="kw">=</span> <span class="no">LR_data_det</span>$<span class="no">mouseReceptor</span>


<span class="co">## get statistical significance of gene pair expression changes based on expression ##</span>
<span class="no">expr_only_scores</span> <span class="kw">=</span> <span class="fu"><a href="../reference/exprCellCellcom.html">exprCellCellcom</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                                   <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
                                   <span class="kw">random_iter</span> <span class="kw">=</span> <span class="fl">1000</span>,
                                   <span class="kw">gene_set_1</span> <span class="kw">=</span> <span class="no">select_ligands</span>,
                                   <span class="kw">gene_set_2</span> <span class="kw">=</span> <span class="no">select_receptors</span>)

<span class="co">## get statistical significance of gene pair expression changes upon cell-cell interaction</span>
<span class="no">spatial_all_scores</span> <span class="kw">=</span> <span class="fu"><a href="../reference/spatCellCellcom.html">spatCellCellcom</a></span>(<span class="no">VC_test</span>,
                                     <span class="kw">spatial_network_name</span> <span class="kw">=</span> <span class="st">'spatial_network'</span>,
                                     <span class="kw">cluster_column</span> <span class="kw">=</span> <span class="st">'cell_types'</span>,
                                     <span class="kw">random_iter</span> <span class="kw">=</span> <span class="fl">1000</span>,
                                     <span class="kw">gene_set_1</span> <span class="kw">=</span> <span class="no">select_ligands</span>,
                                     <span class="kw">gene_set_2</span> <span class="kw">=</span> <span class="no">select_receptors</span>,
                                     <span class="kw">adjust_method</span> <span class="kw">=</span> <span class="st">'fdr'</span>,
                                     <span class="kw">do_parallel</span> <span class="kw">=</span> <span class="no">T</span>,
                                     <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">12</span>,
                                     <span class="kw">verbose</span> <span class="kw">=</span> <span class="st">'a little'</span>)


<span class="co">## select top LR ##</span>
<span class="no">selected_spat</span> <span class="kw">=</span> <span class="no">spatial_all_scores</span>[<span class="no">p.adj</span> <span class="kw">&lt;=</span> <span class="fl">0.01</span> <span class="kw">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">log2fc</span>) <span class="kw">&gt;</span> <span class="fl">0.25</span> <span class="kw">&amp;</span> <span class="no">lig_nr</span> <span class="kw">&gt;=</span> <span class="fl">4</span> <span class="kw">&amp;</span> <span class="no">rec_nr</span> <span class="kw">&gt;=</span> <span class="fl">4</span>]
<span class="fu">setorder</span>(<span class="no">selected_spat</span>, -<span class="no">PI</span>)

<span class="no">top_LR_ints</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">selected_spat</span>[<span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(-<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">PI</span>))]$<span class="no">LR_comb</span>)[<span class="fl">1</span>:<span class="fl">33</span>]
<span class="no">top_LR_cell_ints</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">selected_spat</span>[<span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(-<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">PI</span>))]$<span class="no">LR_cell_comb</span>)[<span class="fl">1</span>:<span class="fl">33</span>]

<span class="fu"><a href="../reference/plotCCcomDotplot.html">plotCCcomDotplot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                 <span class="kw">comScores</span> <span class="kw">=</span> <span class="no">spatial_all_scores</span>,
                 <span class="kw">selected_LR</span> <span class="kw">=</span> <span class="no">top_LR_ints</span>,
                 <span class="kw">selected_cell_LR</span> <span class="kw">=</span> <span class="no">top_LR_cell_ints</span>,
                 <span class="kw">cluster_on</span> <span class="kw">=</span> <span class="st">'PI'</span>,
                 <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'14_communication_dotplot'</span>, <span class="kw">save_format</span> <span class="kw">=</span> <span class="st">'pdf'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/14_communication_dotplot.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="co">## spatial vs rank ####</span>
<span class="no">comb_comm</span> <span class="kw">=</span> <span class="fu"><a href="../reference/combCCcom.html">combCCcom</a></span>(<span class="kw">spatialCC</span> <span class="kw">=</span> <span class="no">spatial_all_scores</span>,
                      <span class="kw">exprCC</span> <span class="kw">=</span> <span class="no">expr_only_scores</span>)

<span class="co"># top differential activity levels for ligand receptor pairs</span>
<span class="fu"><a href="../reference/plotRankSpatvsExpr.html">plotRankSpatvsExpr</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
                   <span class="no">comb_comm</span>,
                   <span class="kw">expr_rnk_column</span> <span class="kw">=</span> <span class="st">'exprPI_rnk'</span>,
                   <span class="kw">spat_rnk_column</span> <span class="kw">=</span> <span class="st">'spatPI_rnk'</span>,
                   <span class="kw">midpoint</span> <span class="kw">=</span> <span class="fl">10</span>,
                   <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'14_expr_vs_spatial_activity'</span>,
                                  <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">4.5</span>, <span class="kw">save_format</span> <span class="kw">=</span> <span class="st">'pdf'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/14_expr_vs_spatial_activity.png" style="width:10cm">
</center>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="co">## recovery ####</span>
<span class="co">## predict maximum differential activity</span>
<span class="fu"><a href="../reference/plotRecovery.html">plotRecovery</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>,
             <span class="no">comb_comm</span>,
             <span class="kw">expr_rnk_column</span> <span class="kw">=</span> <span class="st">'exprPI_rnk'</span>,
             <span class="kw">spat_rnk_column</span> <span class="kw">=</span> <span class="st">'spatPI_rnk'</span>,
             <span class="kw">ground_truth</span> <span class="kw">=</span> <span class="st">'spatial'</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'14_spatial_recovery_activity'</span>,
                            <span class="kw">base_height</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">base_width</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">save_format</span> <span class="kw">=</span> <span class="st">'pdf'</span>))</pre></body></html></div>
<center>
<img src="../inst/images/mouse_seqFISH_SS_cortex/vignette_200319/14_spatial_recovery_activity.png" style="width:10cm">
</center>
</div>
<div id="part-15-export-giotto-analyzer-to-viewer" class="section level2">
<h2 class="hasAnchor">
<a href="#part-15-export-giotto-analyzer-to-viewer" class="anchor"></a>part 15: export Giotto Analyzer to Viewer</h2>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">viewer_folder</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">results_folder</span>, <span class="st">'/'</span>, <span class="st">'Mouse_cortex_viewer'</span>)

<span class="co"># select annotations, reductions and expression values to view in Giotto Viewer</span>
<span class="fu"><a href="../reference/pDataDT.html">pDataDT</a></span>(<span class="no">VC_test</span>)
<span class="fu"><a href="../reference/exportGiottoViewer.html">exportGiottoViewer</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">VC_test</span>, <span class="kw">output_directory</span> <span class="kw">=</span> <span class="no">viewer_folder</span>,
                   <span class="kw">factor_annotations</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'cell_types'</span>,
                                          <span class="st">'leiden_clus'</span>,
                                          <span class="st">'sub_leiden_clus_select'</span>,
                                          <span class="st">'HMRF_2_k9_b.28'</span>),
                   <span class="kw">numeric_annotations</span> <span class="kw">=</span> <span class="st">'total_expr'</span>,
                   <span class="kw">dim_reductions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'umap'</span>),
                   <span class="kw">dim_reduction_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'umap'</span>),
                   <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>,
                   <span class="kw">expression_rounding</span> <span class="kw">=</span> <span class="fl">3</span>,
                   <span class="kw">overwrite_dir</span> <span class="kw">=</span> <span class="no">T</span>)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.rubendries.com/">Ruben Dries</a>, Huipeng Li, Qian Zhu, Rui Dong, Guo-Cheng Yuan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
